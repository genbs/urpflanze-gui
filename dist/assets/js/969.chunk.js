(self.webpackChunk_genbs_urpflanze_gui=self.webpackChunk_genbs_urpflanze_gui||[]).push([[969],{21680:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67294),r=n(29163),i=n(76383);const o=e=>{const t=e.id||"cb_"+e.name;return a.createElement(s,null,a.createElement(l,{size:e.size||0,id:t,type:"checkbox",onChange:t=>e.onChange(t.target.checked),checked:e.checked}),e.name&&a.createElement("label",{htmlFor:t},e.name))},s=r.ZP.div`
    display: flex;
    align-items: center;
    > label { margin-left: ${i.Z.ms(-1)}; }
    > * { 
        cursor: pointer; 
    }
`,l=r.ZP.input`
    position: relative;
    appearance: none;
    margin: 0;
    border-radius: 2px;
    width: ${e=>i.Z.ms(e.size)};
    height: ${e=>i.Z.ms(e.size)};
    
    border: 1px solid ${i.Z.color("gray-dark")};
    transition: 0.1s border-color ease-out;

    &:after{
        position: absolute;
        width: 100%;
        height: 100%;
        display: block;
        content: ' ';
        background: ${i.Z.color("gray-dark")};
        transform: scale(.7);
        transform-origin: center center;
        transition: 0.1s background ease-out;
        border-radius: 2px;
    }

    &:checked {
        border-color: ${i.Z.color("primary")};

        &:after{ 
            background: ${i.Z.color("primary")}; 
        }
    }
`},47790:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var a=n(67294),r=n(29163),i=n(76383),o=n(100),s=n(99011),l=n(38166),c=n(62957);const d=r.ZP.div`
	display: none;
	position: absolute;
	z-index: 100;
	height: 100%;
	top: 0;
	background: ${i.Z.palette.get("dark-lighten","hex").lighten(5)};
	cursor: pointer;
`,m=r.ZP.div`
	position: relative;
	height: ${e=>e.small?i.Z.ms(0):e.size?"string"==typeof e.size?e.size:i.Z.ms(e.size):"100%"};
	line-height: ${e=>e.small?i.Z.ms(0):e.size?"string"==typeof e.size?e.size:i.Z.ms(e.size):"inherit"};
	font-size: ${e=>e.small?i.Z.sub(-1):null};
	background: ${i.Z.palette.get("dark","hex")};

	width: 100%;
	&:hover ${d} {
		display: block;
	}
`,u=r.ZP.input`
	display: inline-block;
	width: 100%;
	height: 100%;
	padding: 0 ${i.Z.ms(-1)};
	background: ${i.Z.palette.get("dark","hex").darken(5)};
	border: none;
	color: #fff;
`,p=r.ZP.div`
	position: relative;
	height: 100%;
	opacity: ${e=>e.bDefaultValue?.3:1};
	cursor: ew-resize;

	&:hover {
		background: rgba(255, 255, 255, 0.2);
	}
`,h=r.ZP.div`
	height: 100%;
	background: ${i.Z.palette.get("primary","hex")};
	pointer-events: none;
`,f=r.ZP.div`
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	pointer-events: none;
`,g=a.memo((({min:e,max:t,step:n,value:r,small:i,size:g,onChange:v,bDefaultValue:y})=>{const[b]=(0,c.Z)(),[E,Z]=a.useState(!1),w=n.toExponential(1).match(/e(-?[0-9]+)/),x=Math.pow(10,w?-w[1]:0);function k(n,a){return n=(0,o.clamp)(e,t,n),v(n,a),n!==r}function _(a,i=1){k((0,o.clamp)(e,t,Math.round((r+i*n*a)*x)/x),"none")}function C(e){const t=parseFloat(e.replace(/,/g,"."));return!Number.isNaN(t)&&(t==r||k(t,"none"))}const[S,$]=(0,l.Z)({value:r,min:e,max:t,step:n,exp:x,onChange:k,events:{notDrag:()=>{b.current&&C(b.current.value)&&Z(!1)},dragEnd:e=>{!e&&Z(!0)}}});return a.createElement(m,{small:i,size:g},E?a.createElement(u,{ref:b,defaultValue:r,autoFocus:!0,onKeyDown:e=>"Enter"===e.key&&C(e.target.value)&&Z(!1),onFocus:e=>e.target.select()}):a.createElement(a.Fragment,null,a.createElement(d,{style:{left:0},onClick:e=>_(-1,e.shiftKey?10:1)},a.createElement(s.Z,{size:0,rotate:180,name:"arrow-right"})),a.createElement(p,{ref:$,bDefaultValue:y&&S.value===r},a.createElement(h,{style:{width:S.valuePercentage+"%"}}),a.createElement(f,null,S.value.toFixed(Math.log10(x)))),a.createElement(d,{style:{right:0},onClick:e=>_(1,e.shiftKey?10:1)},a.createElement(s.Z,{size:0,name:"arrow-right"}))))}))},84581:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var a=n(67294),r=n(62957),i=n(27722);const o=function(e){const[t]=(0,r.Z)();e=e||{};const[n,o]=a.useState({coords:{x:0,y:0},bDrag:!1,time:0}),s=a.useCallback((({target:a,clientX:r,clientY:s})=>{const l=a===(null==t?void 0:t.current);l&&l!=n.bDrag&&(o({coords:{x:r,y:s},bDrag:!0,time:(0,i.zO)()}),e.onDragStart&&e.onDragStart()),l||e.onNotDrag&&e.onNotDrag()}),[t.current,n.bDrag]),l=a.useCallback((({clientX:t,clientY:a})=>{if(n.bDrag){const r=(0,i.zO)()-n.time,s={x:t-n.coords.x,y:a-n.coords.y};r<300&&0==s.x&&0==s.y&&e.onClick&&e.onClick({x:t,y:a}),o({coords:s,bDrag:!1,time:0}),e.onDragEnd&&e.onDragEnd(s,{x:t,y:a},r)}}),[t.current,n.bDrag]),c=a.useCallback((({clientX:t,clientY:a})=>{if(n.bDrag){const r={x:t-n.coords.x,y:a-n.coords.y};o({coords:r,bDrag:!0,time:0}),e.onDrag&&e.onDrag(r,{x:t,y:a})}}),[t.current,n.bDrag]);return a.useEffect((()=>(document.addEventListener("mousedown",s,{passive:!0}),document.addEventListener("mouseup",l,{passive:!0}),document.addEventListener("mousemove",c,{passive:!0}),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("mouseup",l),document.removeEventListener("mousemove",c)})),[t.current,s,c,l]),t}},62957:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(67294);const r=function(e=null){const t=a.useRef(e),n=a.useCallback((e=>{t.current,t.current=e}),[]);return[t,n]}},38166:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var a=n(67294),r=n(84581),i=n(27106),o=n(73259),s=n(58416);const l=function({value:e,step:t,vertical:n,exp:l,min:c,max:d,onChange:m,events:u}){const p=(0,s.Sr)(c,d,e,0,100),[h,f]=a.useState({value:e,valuePercentage:p}),g=(0,r.Z)({onNotDrag:()=>{u&&u.notDrag&&u.notDrag()},onDragStart:()=>{u&&u.dragStart&&u.dragStart()},onDrag:e=>{const t=y(e);t.value!=h.value&&(f(t),m(t.value,"slider")),u&&u.drag&&u.drag(e)},onDragEnd:e=>{const t=Math.abs(n?e.y:e.x)>0;t&&m(y(e).value,"none"),u&&u.dragEnd&&u.dragEnd(t)}}),v=(0,i.Z)(g);function y(e){const a=(d-c)/t,r=n?100*-e.y/v.height:100*e.x/v.width,i=(0,s.uZ)(0,100,r+p),o=Math.round(i/100*a);return{value:(0,s.uZ)(c,d,Math.round((c+o*t)*l)/l),valuePercentage:i}}return(0,o.Z)(g,((e,n)=>{const a=-1*Math.sign(e),r=n.shiftKey?10:1,i=(0,s.uZ)(c,d,Math.round((h.value+r*t*a)*l)/l);m(i,"none")})),a.useEffect((()=>{f({value:e,valuePercentage:(0,s.Sr)(c,d,e,0,100)})}),[e]),[h,g,v]}},73259:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var a=n(67294);const r=function(e,t){a.useEffect((()=>{function n(n){n.target===e.current&&(n.preventDefault(),t(n.deltaY,n))}return document.addEventListener("wheel",n,{passive:!1}),()=>document.removeEventListener("wheel",n)}),[e.current,t])}},64467:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>$r});var a=n(67294),r=n(51512),i=n(76383),o=n(29163),s=n(8211),l=n(74600),c=n(25999),d=n(4127),m=n(58321),u=n(25448),p=n(27722),h=n(16973),f=n(85763),g=n(22367);class v extends d.Z{constructor(e,t,n,a,r,i,o=!1){var s,l,c;super(e,t,n,a,r,i,o),this.drawerOptions.scale=null!==(s=null==n?void 0:n.scale)&&void 0!==s?s:1,this.drawerOptions.fixedLineWidth=null!==(l=null==n?void 0:n.fixedLineWidth)&&void 0!==l&&l,this.drawerOptions.translate=null!==(c=null==n?void 0:n.translate)&&void 0!==c?c:[0,0]}setOption(e,t){super.setOption(e,t)}applyDraw(e){var t,n,a,r;const i=(0,p.zO)(),o=this.scene,s=this.context;if(!s)return 0;s.globalCompositeOperation="source-over";const l=null!==(t=e.scale)&&void 0!==t?t:1,c=null!==(n=e.translate)&&void 0!==n?n:[0,0],d=null!==(a=e.time)&&void 0!==a?a:0,m=null!==(r=e.simmetricLines)&&void 0!==r?r:0,u=e.fixedLineWidth,g=e.clear,y=e.noBackground,b=e.backgroundImage,E=void 0!==e.ghosts&&e.ghosts>0&&void 0!==e.ghostIndex&&e.ghostIndex>0,Z=E?1-e.ghostIndex/(e.ghosts+.5):0,w=!0===e.ghostAlpha,x=o.width,k=o.height,_=x/k,C=[l,l],S=[x/2-(l>1?c[0]*x/(1/((l-1)/2)):0),k/2-(l>1?c[1]*k/(1/((l-1)/2)):0)];if(g){if(y)s.clearRect(0,0,x,k);else if(s.fillStyle=o.background,s.fillRect(0,0,x,k),b){const t=b instanceof SVGImageElement?b.width.baseVal.value:b.width,n=b instanceof SVGImageElement?b.height.baseVal.value:b.height,a=t/n;let r=0,i=0,o=x,l=k;a!==_&&("contain"===e.backgroundImageFit?(o=_>a?t*k/n:x,l=_>a?k:n*x/t):(o=_<a?t*k/n:x,l=_<a?k:n*x/t),r=(x-o)/2,i=(k-l)/2),s.drawImage(b,r,i,o,l)}m>0&&v.drawSimmetricLinesWithScaleAndTranslate(s,m,x,k,o.color,C,S)}{let e=!1,t=!1;o.currentTime=d,o.getChildren().forEach((n=>{n.data&&(!1===n.data.visible||E&&!0===n.data.disableGhost)||(n.generate(d,!0),s.save(),n.stream((n=>{const a=n.currentIndexing,r=a.shape,i=r.data||{},c={canvasContext:s,shape:r,repetition:a.repetition,parent:a.parent,time:o.currentTime,context:f.Z};s.beginPath(),s.moveTo((n.buffer[n.frameBufferIndex]-x/2)*C[0]+S[0],(n.buffer[n.frameBufferIndex+1]-k/2)*C[1]+S[1]);for(let e=2;e<n.frameLength;e+=2)s.lineTo((n.buffer[n.frameBufferIndex+e]-x/2)*C[0]+S[0],(n.buffer[n.frameBufferIndex+e+1]-k/2)*C[1]+S[1]);if(a.shape.isClosed()&&s.closePath(),i&&i.highlighted){const e=h.Z.getStreamDrawerProp(r,"lineWidth",c,1);return s.lineWidth=3*e*l,s.strokeStyle=o.color,void s.stroke()}let d=h.Z.getStreamDrawerProp(r,"fill",c);if(void 0!==d){if(E&&w){const t=h.Z.ghostifyColor(d,Z);t?d=t:e||(console.warn(`[Urpflanze:DrawerCanvas] Unable ghost fill color '${d}',\n\t\t\t\t\t\t\t\tplease enter a rgba or hsla color`),e=!0)}s.fillStyle=d,s.fill()}let m=h.Z.getStreamDrawerProp(r,"stroke",c,void 0===d?o.color:void 0),p=h.Z.getStreamDrawerProp(r,"lineWidth",c,1);if(m){if(E&&w){const e=h.Z.ghostifyColor(m,Z);e?m=e:t||(console.warn(`[Urpflanze:DrawerCanvas] Unable ghost stroke color '${m}',\n\t\t\t\t\t\t\t\tplease enter a rgba or hsla color`),t=!0),p*=Z}s.lineWidth=u?p:p*l,s.strokeStyle=m,s.stroke()}})),s.restore())}))}return(0,p.zO)()-i}static generateImage(e,t=800,n=800,a,r){const i=new s.Z({width:t,height:n,background:a,color:r}),o=u.Z.create(e);if(o){const e=u.Z.copy(o,i,!0);if(e){i.add(e),i.update(0);const a=!1,r=v.adaptShapeToScene(e,i);return v.getSceneImage(i,t,n,a,r).then((e=>e.length?e:"/assets/images/broken-shape.png"))}}return Promise.resolve("/assets/images/broken-shape.png")}static adaptShapeToScene(e,t,n=1){t.update(0);const a=m.Z.getBounding(e.getBuffer());return.9*(n=Math.min(t.width,t.height)/Math.max(a.width,a.height)*n)}static getSceneImage(e,t=800,n=800,a=!1,r){return new Promise((i=>{if("undefined"!=typeof OffscreenCanvas){const o=new OffscreenCanvas(t,n);new v(e,o).applyDraw({time:0,fixedLineWidth:a,scale:r}),o.convertToBlob({type:"image/png",quality:.95}).then((e=>{const t=new FileReader;t.addEventListener("load",(()=>t.result?i(t.result):i("")),{passive:!0}),t.readAsDataURL(e)}))}else{const o=document.createElement("canvas");o.width=t,o.height=n,o.style.width=t+"px",o.style.height=n+"px";new v(e,o,{time:0,fixedLineWidth:a,scale:r}).applyDraw({time:0,fixedLineWidth:a,scale:r}),i(o.toDataURL())}}))}static drawSimmetricLinesWithScaleAndTranslate(e,t,n,a,r,i,o){const s=Math.PI/t,l=Math.max(n,a),c=[l/2,l/2];for(let n=0;n<t;n++){const t=[-l,-l],a=[2*l,2*l],d=n*s+Math.PI/4;g.Z.rotateZ(t,c,d),g.Z.rotateZ(a,c,d),e.beginPath(),e.strokeStyle=r,e.lineWidth=1,e.moveTo((t[0]-l/2)*i[0]+o[0],(t[1]-l/2)*i[1]+o[1]),e.lineTo((a[0]-l/2)*i[0]+o[0],(a[1]-l/2)*i[1]+o[1]),e.stroke()}}}const y=v;var b;!function(e){e[e.UNDO=0]="UNDO",e[e.REDO=1]="REDO",e[e.NONE=2]="NONE"}(b||(b={}));var E=n(58416);const Z=class{constructor(e,t={},n=!1,a){this.id=e,this.preventPushToHistory=n||!1,this.data=t,this.setDescriptor()}redo(e){if(!this.passive){if(this.status!=b.REDO)try{(this.handleRedo(e)||!1)&&(this.status=b.REDO)}catch(e){return console.error(e),b.NONE}return this.status}return b.NONE}undo(e){if(!this.passive){if(this.status!=b.UNDO)try{(this.handleUndo(e)||!1)&&(this.status=b.UNDO)}catch(e){return console.error(e),b.NONE}return this.status}return b.NONE}handleRedo(e){return!1}handleUndo(e){return!1}setDescriptor(){}};const w=class extends Z{constructor(){super(...arguments),this.slug="add",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]}}handleRedo(e){const t=e.getScene(),n=(e.getDrawer(),u.Z.create(this.data.type,{id:this.data.added_id,name:this.data.added_name,order:this.data.added_order},t));if(n&&null==t.find(this.data.added_id)){if(n.scene=t,this.data.props&&Object.keys(this.data.props).forEach((e=>u.Z.set(n,e,this.data.props[e],t))),this.data.parent_id){const e=t.find(this.data.parent_id);if(!e)return!1;u.Z.add(e,n,void 0,t)}else t.add(n);return this.data.added_order=this.data.added_order||(null==n?void 0:n.order),this.data.added_name=this.data.added_name||(null==n?void 0:n.name),this.data.added_id=n.id,this.effects.select_layer=[this.data.added_id],!0}}handleUndo(e){const t=e.getScene();if(t.find(this.data.added_id))return t.removeFromId(this.data.added_id),this.effects.select_layer=[],!0}setDescriptor(){this.data.parent_id?this.descriptor=`add "${this.data.type}" to ${this.data.parent_id}`:this.descriptor=`add "${this.data.type}" to Scene`}};const x=class extends Z{constructor(e,t,n=!1,a){super(e,t,n,a),this.slug="remove",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]},t=Array.isArray(t)?t:[t];const r=a.getScene();a.getDrawer();this.data=t.map((e=>{var t;const n=r.find(e);return n?{id:e,copied_sceneChild:u.Z.copy(n,r,!0),parent_id:(null===(t=u.Z.getParent(n))||void 0===t?void 0:t.id)||null}:null})).filter((e=>!!e)).sort(((e,t)=>e&&t?e.copied_sceneChild.order-t.copied_sceneChild.order:0)),this.setDescriptor()}handleRedo(e){let t=!1;return this.data.forEach((n=>{const a=e.getScene().find(n.id);a&&(u.Z.remove(a),t=!0)})),t}handleUndo(e){let t=!1;return this.data.forEach((n=>{if(n.copied_sceneChild&&!e.getScene().find(n.id)){const a=n.copied_sceneChild,r=n.parent_id?e.getScene().find(n.parent_id):null;n.parent_id&&r?(u.Z.add(r,a),t=!0):null==n.parent_id&&(e.getScene().add(a),t=!0)}})),t}setDescriptor(){var e;this.data.length>=0?this.descriptor=`remove "${null===(e=this.data[0].copied_sceneChild)||void 0===e?void 0:e.id}"`:this.descriptor=`remove "${this.data.length}" scenechild`}};var k=n(79324);const _=class extends Z{constructor(e,t,n=!1,a){super(e,Array.isArray(t)?t:[t],n,a),this.slug="set-prop",this.passive=!1,this.effects={scene_update:!0,scene_child_prop_update:this.data.map((e=>({id:e.id,name:e.name,value:e.value})))},this.setDescriptor(a)}handleRedo(e){let t=!1,n=0;return this.data.forEach((({id:a,name:r,value:i})=>{const o=e.getScene().find(a);if(o&&this.effects.scene_child_prop_update){u.Z.set(o,r,i,e.getScene()),this.effects.scene_child_prop_update[n++].value=i,o instanceof k.Z&&u.Z.getChildren(o).forEach((e=>{this.effects.scene_child_prop_update[n++]={id:e.id,name:r,value:i}}));const a=u.Z.getParent(o);a&&a instanceof k.Z&&(a.setPropUnsafe(r,void 0),this.effects.scene_child_prop_update[n++]={id:a.id,name:r,value:void 0}),t=t||!0}})),t}handleUndo(e){let t=!1,n=0;return this.data.forEach((({id:a,name:r,prev_value:i})=>{const o=e.getScene().find(a);if(o&&this.effects.scene_child_prop_update){u.Z.set(o,r,i,e.getScene()),this.effects.scene_child_prop_update[n++].value=i,o instanceof k.Z&&u.Z.getChildren(o).forEach((e=>{this.effects.scene_child_prop_update[n++]={id:e.id,name:r,value:i}}));const a=u.Z.getParent(o);a&&a instanceof k.Z&&(a.setPropUnsafe(r,i),this.effects.scene_child_prop_update[n++]={id:a.id,name:r,value:i}),t=t||!0}})),t}setDescriptor(e){var t;if(1==this.data.length){const{name:n,id:a,prev_value:r,value:i}=this.data[0],o=(null===(t=null==e?void 0:e.getScene().find(a))||void 0===t?void 0:t.name)||a;this.descriptor=`set prop "${n}" of "${o}" from "${r}" to "${i}"`}else this.descriptor="set multiple prop"}};const C=class extends Z{constructor(e,t,n=!1,a){super(e,Array.isArray(t)?t:[t],n,a),this.slug="set-prop",this.passive=!1,this.effects={scene_update:!0,scene_child_ui_prop_update:this.data.map((e=>({id:e.id,name:e.name,value:e.value})))},this.setDescriptor(a)}handleRedo(e){let t=!1,n=0;return this.data.forEach((({id:a,name:r,value:i})=>{const o=e.getScene().find(a);o&&this.effects.scene_child_ui_prop_update&&(o.data[r]=i,this.effects.scene_child_ui_prop_update[n++].value=i,t=t||!0)})),t}handleUndo(e){let t=!1,n=0;return this.data.forEach((({id:a,name:r,prev_value:i})=>{const o=e.getScene().find(a);o&&this.effects.scene_child_ui_prop_update&&(o.data[r]=i,this.effects.scene_child_ui_prop_update[n++].value=i,t=t||!0)})),t}setDescriptor(e){var t;if(1==this.data.length){const{name:n,id:a,prev_value:r,value:i}=this.data[0],o=(null===(t=null==e?void 0:e.getScene().find(a))||void 0===t?void 0:t.name)||a;this.descriptor=`set ui prop "${n}" of "${o}" from "${r}" to "${i}"`}else this.descriptor="set multiple prop"}};const S=class extends Z{constructor(e,t,n=!1,a){super(e,t,n,a),this.slug="make-shape",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]},this.data={ids:t,sceneChilds:t.map((e=>a.getScene().find(e))).filter((e=>null!==e)).sort(((e,t)=>(e.order||0)-(t.order||0)))}}hasSameParents(e){if(e.length<=1)return!0;const t=e.map((e=>u.Z.getParent(e)));let n=t[0];for(let e=1,a=t.length;e<a;e++){if(n!=t[e])return!1;n=t[e]}return!0}handleRedo(e){const t=e.getScene();if(this.data.sceneChilds.length>0&&this.hasSameParents(this.data.sceneChilds)){const n=this.data.sceneChilds,a=u.Z.getParent(n[0]),r=u.Z.create("Shape",{id:this.data.new_shape_id},t);return n.forEach((e=>{u.Z.remove(e),u.Z.add(r,e,void 0,t)})),a?u.Z.add(a,r):e.getScene().add(r),this.data.parent_id=a?a.id:null,this.data.new_shape_id=r.id,this.effects.select_layer=[this.data.new_shape_id],!0}}handleUndo(e){const t=e.getScene();if(this.data.sceneChilds.length>0&&this.data.new_shape_id){t.removeFromId(this.data.new_shape_id);const e=this.data.parent_id?t.find(this.data.parent_id):null;return e?this.data.sceneChilds.forEach((t=>u.Z.add(e,t))):this.data.sceneChilds.forEach((e=>t.add(e))),this.effects.select_layer=this.data.sceneChilds.map((e=>e.id)),!0}}setDescriptor(){this.descriptor="make shape"}};var $=n(31631);const j=class extends Z{constructor(e,t,n,a=!1,r){super(e,n,!0,r),this.slug="move",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:null},this.data={id:n,move:t,sceneChild:r.getScene().find(n)},this.setDescriptor()}handleRedo(e){var t;const n=e.getScene();if(this.data.sceneChild){const e=u.Z.getParent(this.data.sceneChild)||n;if(e instanceof s.Z||e instanceof k.Z){const n=u.Z.getNeighbors(this.data.sceneChild),a=(0,$.indexOfObjectProperty)(n,"id",this.data.sceneChild.id),r="up"==this.data.move?a-1:"top"==this.data.move?0:"down"==this.data.move?a+1:n.length-1;r>=0&&r<n.length&&(n[a].order=(null!==(t=n[r].order)&&void 0!==t?t:0)+(r>a?1:-1),e.sortChildren())}return!0}}handleUndo(e){var t;const n=e.getScene();if(this.data.sceneChild){const e=u.Z.getParent(this.data.sceneChild)||n;if(e instanceof s.Z||e instanceof k.Z){const n=u.Z.getNeighbors(this.data.sceneChild),a=(0,$.indexOfObjectProperty)(n,"id",this.data.sceneChild.id),r="down"==this.data.move?a-1:"bottom"==this.data.move?0:"up"==this.data.move?a+1:n.length-1;r>=0&&r<n.length&&(n[a].order=(null!==(t=n[r].order)&&void 0!==t?t:0)+(r>a?1:-1),e.sortChildren())}return!0}}setDescriptor(){this.descriptor="move "+this.data.move}};const O=class extends j{constructor(e,t,n=!1,a){super(e,"up",t,n,a),this.slug="move-up"}};const P=class extends j{constructor(e,t,n=!1,a){super(e,"down",t,n,a),this.slug="move-down"}};const D=class extends j{constructor(e,t,n=!1,a){super(e,"top",t,n,a),this.slug="move-to-top"}};const z=class extends j{constructor(e,t,n=!1,a){super(e,"bottom",t,n,a),this.slug="move-to-bottom"}};var A=n(87710);function R(e,t){const n=e.getBuffer();let a=null;if(n){const r=e.getProp("repetitions",void 0,1);e.generate(-1);const i=e.getIndexedBuffer();console.log(e,i);let o=0;for(let e=0;e<r;e++){const r=i[e].frameLength,s=new Array(r/2);for(let e=0,t=0;e<r;e+=2,t++,o+=2)s[t]={X:n[o],Y:n[o+1]};a=a?a[t](new A.ZP([s])):new A.ZP([s])}}return a||new A.ZP([[]])}const T=class extends Z{constructor(){super(...arguments),this.slug="shape-operation",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]}}handleRedo(e){const t=e.getScene(),n=(e.getDrawer(),t.find(this.data.a_id)),a=t.find(this.data.b_id);if(n&&a){const e=n.getBuffer(),r=a.getBuffer();if(e&&r&&e.length>0&&r.length>0){this.data.a=n,this.data.b=a;const e=function(e){const t=Array.prototype.concat.apply([],e.paths),n=2*t.length,a=new Float32Array(n);for(let e=0,r=0;e<n;e+=2,r++)a[e]=t[r].X,a[e+1]=t[r].Y;const r=m.Z.getBounding(a),i=r.width>r.height?1:r.width/r.height,o=r.width>r.height?r.height/r.width:1,s=e.paths.length,l=new Array(s);for(let t=0;t<s;t++){const n=e.paths[t],a=2*n.length,s=new Float32Array(a);for(let e=0,t=0;e<a;e+=2,t++)s[e]=i*((n[t].X-r.cx)/r.width)*2,s[e+1]=o*((n[t].Y-r.cy)/r.height)*2;l[t]=s}return l}(R(n,this.data.type)[this.data.type](R(a,this.data.type)));if(e&&e.length>0){const a=u.Z.getParent(n);let r=null;if(1==e.length)r=u.Z.create("ShapeBuffer",{shape:e[0]},t);else{r=u.Z.create("Shape",void 0,t);const n=u.Z.getCountSceneChildOfType(t,"ShapeBuffer")+1;if(r)for(let a=0;a<e.length;a++){const i=u.Z.create("ShapeBuffer",{shape:e[a]},t);i&&u.Z.add(r,i,{name:`ShapeBuffer_${n+a}`},t)}}if(r)return this.data.new_id=r.id,a?u.Z.add(a,r,void 0,t):t.add(r),t.removeFromId(this.data.a_id),t.removeFromId(this.data.b_id),this.effects.select_layer=[this.data.new_id],!0}}}return!1}handleUndo(e){const t=e.getScene();if(t.find(this.data.new_id)){t.removeFromId(this.data.new_id);const e=this.data.a_parent_id?t.find(this.data.a_parent_id):null,n=this.data.b_parent_id?t.find(this.data.b_parent_id):null;return e?u.Z.add(e,this.data.a,void 0,t):t.add(this.data.a),n?u.Z.add(n,this.data.b,void 0,t):t.add(this.data.b),this.effects.select_layer=[this.data.a_id,this.data.b_id],!0}}setDescriptor(){this.descriptor=`shape "${this.data.type}"`}};var L=n(79340);const I=class extends Z{constructor(){super(...arguments),this.slug="create-from-buffer",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]}}handleRedo(e){const t=e.getScene(),n=function(e,t){var n;const a=e.getScene();let r=null;if(t.buffers.length){null===(n=L.Z.sideLength)||void 0===n||n.default;switch(t.buffers.length){case 0:r=null;break;case 1:r=u.Z.create("ShapeBuffer",{shape:t.buffers[0].buffer,bClosed:t.buffers[0].closed,style:{fill:t.buffers[0].fill,stroke:t.buffers[0].stroke,lineWidth:t.buffers[0].lineWidth}},a);break;default:r=u.Z.create("Shape",void 0,a),r&&t.buffers.forEach(((e,t)=>{const n=u.Z.create("ShapeBuffer",{shape:e.buffer,bClosed:e.closed,style:{fill:e.fill,stroke:e.stroke,lineWidth:e.lineWidth}},a);n&&u.Z.add(r,n,void 0,a)}))}a&&r&&a.add(r)}return r}(e.getDrawer(),this.data);if(n&&null===t.find(this.data.added_id))return this.data.added_id=n.id,this.effects.select_layer=[this.data.added_id],!0}handleUndo(e){const t=e.getScene();if(t.find(this.data.added_id))return t.removeFromId(this.data.added_id),this.effects.select_layer=[],!0}setDescriptor(){this.descriptor="create from buffer"}};const M=class extends Z{constructor(e,t,n=!1,a){var r,i;super(e,t,n,a),this.slug="copy",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]},this.data.refName=(null===(i=null===(r=a.getScene())||void 0===r?void 0:r.find(this.data.id))||void 0===i?void 0:i.name)||""}handleRedo(e){const t=e.getScene(),n=(e.getDrawer(),t.find(this.data.id));if(n){const e=u.Z.copy(n,t);if(e){if(this.data.parent_id){const n=t.find(this.data.parent_id);if(!n)return!1;u.Z.add(n,e,void 0,t)}else t.add(e);return this.data.added_order=this.data.added_order||(null==e?void 0:e.order),this.data.added_name=this.data.added_name||(null==e?void 0:e.name),this.data.added_id=e.id,this.effects.select_layer=[this.data.added_id],!0}}}handleUndo(e){const t=e.getScene().find(this.data.added_id);if(t)return u.Z.remove(t),this.effects.select_layer=[],!0}setDescriptor(){this.descriptor=`copy "${this.data.refName}"`}};const F=class extends Z{constructor(e,t,n=!1,a){super(e,t,n,a),this.slug="cut",this.passive=!1,this.effects={scene_update:!0,scene_layers_update:!0,select_layer:[]};const r=a.getScene().find(this.data.id);r&&(this.data.parentSceneChild=u.Z.getParent(r),this.data.refName=r.name)}handleRedo(e){const t=e.getScene(),n=t.find(this.data.id);if(n){if(u.Z.remove(n),this.data.parent_id){const e=t.find(this.data.parent_id);e&&u.Z.add(e,n,void 0,t)}else t.add(n);return this.effects.select_layer=[this.data.id],!0}}handleUndo(e){const t=e.getScene(),n=t.find(this.data.id);if(n)return u.Z.remove(n),this.data.parentSceneChild?u.Z.add(this.data.parentSceneChild,n):t.add(n),this.effects.select_layer=[],!0}setDescriptor(){this.descriptor=`cut "${this.data.refName}"`}};var B=n(34406);const N=class extends Z{constructor(e,t,n=!1,a){super(e,t,n,a),this.slug="subdivide",this.passive=!1,this.effects={scene_update:!0,scene_child_prop_update:[{id:t.id,name:"shape",value:null},{id:t.id,name:"type",value:"ShapeBuffer"}]},this.setDescriptor(a)}handleRedo(e){let t=!1;const n=e.getScene().find(this.data.id);return n&&n instanceof B.Z&&this.effects.scene_child_prop_update&&(this.data.prev_shape=Float32Array.from(n.shape),n.subdivide(),n.type="ShapeBuffer",this.effects.scene_child_prop_update[0].value=n.shape,t=!0),t}handleUndo(e){let t=!1;const n=e.getScene().find(this.data.id);return n&&n instanceof B.Z&&this.effects.scene_child_prop_update&&(n.setShape(this.data.prev_shape),this.effects.scene_child_prop_update[0].value=n.shape,t=!0),t}setDescriptor(e){this.descriptor="subdivide shapebuffer points"}};class H extends l.Z{constructor(){super(),this.command_increment_id=0,this.commmands={add:w,copy:M,cut:F,"create-from-buffer":I,"shape-operation":T,remove:x,"set-prop":_,"set-ui-prop":C,"make-shape":S,"move-up":O,"move-down":P,"move-to-top":D,"move-to-bottom":z,subdivide:N},this.history=[],this.current_history_index=0}execute(e,t,n,a){if(!(t in this.commmands))return void console.warn(`Command history: command "${t}" not recognized.`);const r=new this.commmands[t](++this.command_increment_id,n,a,e);return r.redo(e)!==b.NONE?r.preventPushToHistory?{scene_update:r.effects.scene_update,scene_layers_update:r.effects.scene_layers_update}:(this.reindexingHistory(),this.history.unshift(r),this.history.length>=H.MAX_HISTORY&&(this.history=this.history.slice(0,H.MAX_HISTORY)),this.dispatchHistoryUpdate(),r.effects):void 0}handleCommandEffect(e,t){e&&Object.keys(e).forEach((n=>{const a=Array.isArray(e[n])?e[n]:[e[n]];switch(n){case"scene_child_prop_update":if(void 0===t[n])t[n]=[a];else{const r=t[n];let i=!1;for(let e=0,t=r.length;e<t;e++)for(let t=0,n=a.length;e<n;e++)r[e].id==a[t].id&&r[e].name==a[t].name&&(r[e].value=a.value,i=!0);!i&&t[n].push(e[n])}break;default:t[n]=t[n]||e[n]}}))}goTo(e,t){if(t==this.current_history_index)return;const n={};if(t>this.current_history_index)for(let a=t-this.current_history_index-1;a>=0;a--)this.handleCommandEffect(this.undo(e,!0),n);if(t<this.current_history_index)for(let a=this.current_history_index-t-1;a>=0;a--)this.handleCommandEffect(this.redo(e,!0),n);return this.dispatchHistoryUpdate(),n}redo(e,t=!1){if(this.history.length>0&&this.current_history_index>0){const n=(0,E.uZ)(0,this.history.length,this.current_history_index-1),a=this.history[n];return a.redo(e),this.current_history_index=n,t||this.dispatchHistoryUpdate(),a.effects}}undo(e,t=!1){if(this.history.length>=0&&this.current_history_index<this.history.length){const n=(0,E.uZ)(0,this.history.length,this.current_history_index),a=this.history[n];return a.undo(e),this.current_history_index=n+1,t||this.dispatchHistoryUpdate(),a.effects}}reindexingHistory(){if(this.current_history_index>0)for(let e=0,t=this.current_history_index;e<t;e++)this.history.shift();this.current_history_index=0}dispatchHistoryUpdate(){const e=this.history.map(((e,t)=>({id:e.id,command:e.descriptor,level:t,status:e.status,bLast:t==this.current_history_index,passive:e.passive}))).filter((e=>!e.passive));this.dispatch("command_history:update_history",e)}clear(){this.history=[],this.command_increment_id=0,this.current_history_index=0}}H.MAX_HISTORY=100;const q=H;function U(e,t,n){t.data[e]=n,u.Z.getChildren(t).forEach((t=>U(e,t,n)))}var V=n(36427);var W=n(13831),G=n(24114),Y=n(9006);const X=(e,t,n)=>{e.resize(t,t,n),e.redraw()};function K(e,t,n){const a=W.Z.parse(t),r=void 0!==typeof OffscreenCanvas?new OffscreenCanvas(n.size,n.size):document.createElement("canvas");return a.resize(n.size,n.size,a.getRatio()),a.setCanvas(r),a.setOption({noBackground:"image/png"===n.type&&n.noBackground,time:n.time}),a.getTimeline().setTime(n.time),a}var J=n(21265);var Q=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};var ee=n(665),te=n(51205);var ne=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const ae={"export-json":function(e,t){const{name:n}=e.args;return G.Z.parse(t.getDrawer(),n)},"export-gcode":function(e,t){const{settings:n}=e.args;return ee.Z.parse(t.getDrawer(),n)},"import-json":function(e,t){const n=e.args,a=W.Z.parse(n);if(te.Z.log("Temporany","importJSON",n,a),a){t.updateDrawer(a),t.getCommandHistory().clear();const e=G.Z.parseAsProject(a);return e.open_layer_properties=void 0,e.selected_layers=[],e.history=[],t.sendEvent("project:init",e),te.Z.log("Temporany","importJSON init",e),e}return null},"append-json":function(e,t){const n=e.args,a=t.getDrawer(),r=t.getScene(),i=W.Z.parse(n);if(i){const e=i.getScene();e&&e.getChildren().forEach((e=>{r.find(e.id)||r.add(e)}));const n=Object.values(G.Z.parseAsProject(a).scene);return t.sendEvent("scene:update-layers",{layers:n}),a.buffer.flush(),a.redraw(),!0}return!1},"layer-highlight":function(e,t){const n=t.getScene().find(e.args.id);n&&(U("highlighted",n,e.args.status),t.getDrawer().flushBuffer(),t.getDrawer().redraw())},"layer-visibility":[function(e,t){const n=t.getScene().find(e.args.id);n&&(U("visible",n,e.args.status),t.getDrawer().flushBuffer(),t.getDrawer().redraw())},"scene_layers_update"],"layer-ghost":[function(e,t){const n=t.getScene().find(e.args.id);n&&(n.data.disableGhost=e.args.status,t.getDrawer().redraw())},"scene_layers_update",({id:e,status:t})=>({scene_child_ui_prop_update:[{id:e,name:"disableGhost",value:t}]})],"layer-rename":[function(e,t){const{id:n,name:a}=e.args,r=t.getScene().find(n);r&&(r.name=a)},"scene_layers_update"],"toggle-timeline":(e,t)=>{const n=t.getDrawer();n.getTimeline().bSequenceStarted()?n.pauseAnimation():n.playAnimation()},"change-timeline-state":(e,t)=>{const n=t.getDrawer();e.args==V.Z.START?!n.getTimeline().bSequenceStarted()&&n.playAnimation():n.getTimeline().bSequenceStarted()&&n.pauseAnimation()},"set-timeline-duration":(e,t)=>{const n=t.getDrawer(),a=e.args;n.getTimeline().setDuration(a)},"set-timeline-framerate":(e,t)=>{const n=t.getDrawer(),a=e.args;n.getTimeline().setFramerate(a)},"set-timeline":(e,t)=>{const n=t.getDrawer(),a=e.args;n.getTimeline().setTime(a),n.redraw()},"timeline-sequence":(e,t)=>t.getDrawer().getTimeline().getSequence(),"set-drawer-offsets":(e,t)=>{const n=t.getDrawer(),{scale:a,translate:r}=e.args;n.setOption({scale:a,translate:r}),n.redraw()},"set-drawer-lines":(e,t)=>{const n=t.getDrawer(),a=e.args;n.setOption("simmetricLines",a),n.redraw()},"set-drawer-clear":(e,t)=>{const n=t.getDrawer(),a=e.args;n.setOption("clear",a),n.redraw(),t.sendEvent("project:update-properties",{clear:a})},"set-drawer-ghosts":(e,t)=>{const n=t.getDrawer(),{ghosts:a,ghostSkipTime:r}=e.args;n.setOption("ghosts",a),n.setOption("ghostSkipTime",r),n.redraw(),t.sendEvent("project:update-properties",{ghosts:Math.round(10*a)/10,ghostSkipTime:Math.round(10*r)/10})},"set-drawer-ratio":(e,t)=>{const{size:n,ratio:a}=e.args;X(t.getDrawer(),n,a),t.sendEvent("project:update-properties",{ratio:a})},"set-scene-background":(e,t)=>{const n=t.getScene(),a=t.getDrawer(),{background:r,preventDispatch:i}=e.args;n.background=r,a.flushBuffer(),a.redraw(),!i&&t.sendEvent("project:update-properties",{background:r})},"set-background-image":(e,t)=>{const{image:n,source:a}=e.args;t.getDrawer().setOption("backgroundImage",n),t.getDrawer().redraw();const r=a;t.sendEvent("project:update-properties",{backgroundImage:r})},"get-rendered-frames":(e,t)=>t.getDrawer().getRenderedFrames(),"render-image":(e,t)=>{const n=t.getDrawer();n.stopAnimation();const a=e.args.settings,r=G.Z.parse(n),i=t.getRenderer();if("image/svg+xml"===a.type){const e=K(0,r,a);return JSON.stringify({svg:Y.Z.parse(e,a)})}const o=K(0,r,a);return i.renderImage(o,a)},"render-animation":(e,t)=>{const n=t.getDrawer();n.stopAnimation();const a=e.args.settings,r=G.Z.parse(n),i=t.getRenderer(),o=K(0,r,a);return i.renderAnimation(o,a)},"render-stop":(e,t)=>{t.getRenderer().stop()},prop:(e,t)=>{var n;const{id:a,name:r}=e.args,i=t.getScene().find(a);if(0==r.indexOf("loop.")&&i instanceof J.Z){const e=r.substr(5);return null!==(n=i.getLoop()[e])&&void 0!==n?n:void 0}return i?i.getProp(r):void 0},"single-bounding":(e,t)=>{const n=t.getScene(),a=t.getScene().find(e.args.id);if(a){const e=a.getProp("repetitions",void 0,1),t=a.getProp("distance",void 0,0);a.setProp({repetitions:1,distance:0},void 0,!0),a.generate(Math.random(),!0);const r=m.Z.getBounding(a.getBuffer());return a.setProp({repetitions:e,distance:t}),r.x/=n.width,r.y/=n.height,r.cx/=n.width,r.cy/=n.height,r.width/=n.width,r.height/=n.height,r}return null},toolbar:function(e,t){return Q(this,void 0,void 0,(function*(){const{size:t,color:n}=e.args,a=u.Z.getRegistered();["ShapeLoop","ShapeBuffer","Shape","Group"].forEach((e=>{a.splice(a.indexOf(e),1)}));const r=[],i=[];a.forEach((e=>{i.push(y.generateImage(e,t,t,void 0,n))}));const o=yield Promise.all(i);return a.forEach(((e,t)=>{r.push({name:e,image:o[t]})})),r}))},"scene-points":(e,t)=>{const n=t.getScene().getChildren().reduce(((e,t)=>e+t.getBufferLength()),0)/2,a=t.getDrawer().getOption("ghosts",0);return a&&a>0?n*a:n},"get-buffer-length":(e,t)=>{var n;const a=null===(n=t.getScene().find(e.args.id))||void 0===n?void 0:n.getBufferLength();return a?a/2:0}};var re=n(35648);const ie=Float32Array.from([-1,.4957,0,-.0813,1,.4957,1,-.0813,0,-.6582,-1,-.0813]),oe=Float32Array.from([-.3676,.4804,-0,.2683,.3676,.4804,.3676,.2683,-0,.0562,-.3676,.2683]);class se extends re.Z{constructor(e={}){e.type="Desidus",super(e),this.created=!1,e.data.imported||this.buildShape()}buildShape(){var e;if(!this.created&&!this.shape){const t=null===(e=L.Z.sideLength)||void 0===e?void 0:e.default,n=u.Z.create("Group",{name:this.name+"_Group"},this.scene),a=u.Z.create("ShapeBuffer",{name:this.name+"_top",shape:ie},this.scene),r=u.Z.create("ShapeBuffer",{name:this.name+"_bottom",shape:oe},this.scene);a.data.props.sideLength=t,r.data.props.sideLength=t,this.setShape(n),n.add(a),n.add(r),this.created=!0}}setProp(e,t){super.setProp(e,t),this.buildShape()}}const le=se;var ce=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};class de extends l.Z{constructor(){super();const e=new s.Z;e.color=i.Z.color("primary").toString("hex"),e.background=i.Z.color("dark").toString("hex");const t=new y(e);t.getTimeline().setSequence(6e3,60),this.updateDrawer(t),this.renderer=new c.Z,this.commandHistory=new q,this.commandHistory.attach("command_history:update_history",this.sendEvent.bind(this,"command_history:update_history")),this.renderer.attach("renderer:start",this.sendEvent.bind(this,"renderer:start")),this.renderer.attach("renderer:render-frame",this.sendEvent.bind(this,"renderer:render-frame")),u.Z.register("Desidus",le)}sendEvent(e,t){this.dispatch("event",{event:e,data:t})}getScene(){return this.drawer.getScene()}setScene(e){const t=this.getScene();t&&t.resize(t.width,t.height),this.drawer.setScene(e),this.drawer.buffer.flush(),this.drawer.redraw()}getDrawer(){return this.drawer}setDrawer(e){e.canvas&&this.drawer.setCanvas(e.canvas),(e.size||e.ratio)&&X(this.drawer,e.size,e.ratio),this.sendEvent("drawer:update",{})}updateDrawer(e){if(this.drawer&&this.drawer.getCanvas()){const t=this.drawer.getCanvas();e.setCanvas(t)}this.drawer=new y(e.getScene(),e.getCanvas(),e.getOptions(),e.getRatio(),e.getTimeline().getSequence().duration,e.getTimeline().getSequence().framerate),this.drawer.setBuffering(!0);const t=this.drawer.getScene();t&&this.setScene(t),this.drawer.attach("drawer-canvas:buffer_loaded",this.sendEvent.bind(this,"drawer-canvas:buffer_loaded")),this.drawer.attach("drawer-canvas:buffer_flush",this.sendEvent.bind(this,"drawer-canvas:buffer_flush")),this.drawer.getTimeline().attach("timeline:update_sequence",this.sendEvent.bind(this,"timeline:update_sequence")),this.drawer.getTimeline().attach("timeline:change_status",this.sendEvent.bind(this,"timeline:change_status")),this.drawer.getTimeline().attach("timeline:progress",this.sendEvent.bind(this,"timeline:progress")),this.sendEvent("drawer:update",{})}getRenderer(){return this.renderer}getCommandHistory(){return this.commandHistory}read(e){return ce(this,void 0,void 0,(function*(){te.Z.log("Comunication",e.deferred_id,e);try{let t,n;switch(e.type){case"set-drawer":yield this.setDrawer(e.args);break;case"run":{const n=e.args;t=yield this.commandHistory.execute(this,e.command,n.args,n.preventPushToHistory);break}case"ask":{const a=yield function(e,t){return ne(this,void 0,void 0,(function*(){if(e.command in ae){const n=ae[e.command],a=Array.isArray(n)?n:[n];let r;if(a.length>1){r={};for(let t=1;t<a.length;t++){const n=a[t];if("string"==typeof n)r[n]=!0;else{const t=n(e.args);Object.keys(t).forEach((e=>r[e]=t[e]))}}}return{data:yield a[0](e,t),execution_effects:r}}console.warn(`Executor Ask '${e.command}' command not recognized`)}))}(e,this);n=null==a?void 0:a.data,t=null==a?void 0:a.execution_effects;break}case"undo":t=yield this.commandHistory.undo(this);break;case"redo":t=yield this.commandHistory.redo(this);break;case"history":t=yield this.commandHistory.goTo(this,e.args)}if(t){const n={type:"execution-effect",deferred_id:e.deferred_id,effect:"no-effect"};return t.scene_update&&(this.drawer.buffer.flush(),this.drawer.redraw()),t.scene_layers_update&&(n.effect="scene:update-layers",n.data={layers:Object.values(G.Z.parseAsProject(this.drawer).scene),selecteds:t.select_layer?t.select_layer:void 0}),t.scene_child_prop_update&&(n.effect="scene:update-scene_child-prop",n.data=t.scene_child_prop_update),t.scene_child_ui_prop_update&&(n.effect="scene:update-scene_child-ui-prop",n.data=t.scene_child_ui_prop_update),n}return{deferred_id:e.deferred_id,type:"response",command:e.command,data:n}}catch(t){return{deferred_id:e.deferred_id,type:"response-unresolved",command:e.command,data:t}}}))}}const me=de;var ue=n(27118),pe=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};class he extends l.Z{constructor(e){super(),this.bRunOnLocal=e,this.response_promises=[],this.increment_deferred_id=0,this.bCanvasMounted=!1,this.proxyComunicationResponse=this.proxyComunicationResponse.bind(this),this.onDeamonMessage=this.onDeamonMessage.bind(this),this.bRunOnLocal?(this.executor=new me,this.executor.attach("event",(e=>{if(e){const t=Object.assign({type:"event"},e);this.dispatch(t.event,t.data)}}))):(this.deamonWorker=new Worker("assets/js/deamon.js"),this.deamonWorker.addEventListener("message",this.onDeamonMessage))}hasAutosave(){return ue.Z.has("autosave")}getAutosaveProjectId(){var e;return this.hasAutosave()?null===(e=ue.Z.get("autosave",void 0))||void 0===e?void 0:e.id:void 0}autosave(e){return new Promise(((t,n)=>{this.ask("export-json",e).then((e=>{e?(ue.Z.set("autosave",e),t()):n()})).catch(n)}))}restoreAutosave(){return pe(this,void 0,void 0,(function*(){const e=ue.Z.get("autosave",void 0,!0);e&&this.ask("import-json",e)}))}setDrawer(e,t,n,a){if(!this.bCanvasMounted&&e){if(this.bCanvasMounted=!0,this.bRunOnLocal)return console.log("Drawer work sync"),this.proxyComunicationDispatcher("set-drawer","set-drawer",{canvas:e,size:t,ratio:n,resolution:a});{console.log("Drawer work on async service");const r=e.transferControlToOffscreen();return this.proxyComunicationDispatcher("set-drawer","set-drawer",{canvas:r,size:t,ratio:n,resolution:a},[r])}}return this.proxyComunicationDispatcher("set-drawer","set-drawer",{size:t,ratio:n,resolution:a})}run(e,t,n){const a={args:t,preventPushToHistory:n};return this.proxyComunicationDispatcher("run",e,a)}ask(e,t,n){return this.proxyComunicationDispatcher("ask",e,t,n)}undo(){return this.proxyComunicationDispatcher("undo","undo")}redo(){return this.proxyComunicationDispatcher("redo","redo")}history(e=0){return this.proxyComunicationDispatcher("history","history",e)}onDeamonMessage(e){const t=e.data;if("event"==t.type){const e=t;this.dispatch(e.event,e.data)}else{const e=t;this.proxyComunicationResponse(e)}}proxyComunicationDispatcher(e,t,n,a){return pe(this,void 0,void 0,(function*(){const r=this.createDeferred(),i=++this.increment_deferred_id,o={type:e,command:t,args:n,deferred_id:i};return this.dispatch("executor-work",{waiting:this.response_promises.length}),this.response_promises.push({deferred_id:i,promise:r}),this.bRunOnLocal?this.proxyComunicationResponse(yield this.executor.read(o)):this.deamonWorker.postMessage(o,a),r.promise}))}proxyComunicationResponse(e){te.Z.log("ComunicationResponse",e.deferred_id,e);for(let t=0,n=this.response_promises.length;t<n;t++)if(this.response_promises[t].deferred_id===e.deferred_id){"response-unresolved"===e.type?this.response_promises[t].promise.reject(e.data):this.response_promises[t].promise.resolve(e.data),this.response_promises.splice(t,1);break}return 0==this.response_promises.length&&(this.increment_deferred_id=0,this.dispatch("executor-work",{waiting:this.response_promises.length})),"execution-effect"==e.type&&this.dispatch(e.effect,e.data),e}createDeferred(){const e={resolve:void 0,reject:void 0,promise:void 0},t=new Promise(((t,n)=>{e.resolve=t,e.reject=n}));return e.promise=t,e}}const fe=he;var ge=n(84782),ve=n(71866),ye=n(31695);const be=new fe(!(0,p.tg)());window.executor=be,be.attach("project:init",(e=>{ge.Z.dispatch((0,ve.L0)(e))})),be.attach("project:update-properties",(e=>{ge.Z.dispatch((0,ve.JR)(e))})),be.attach("scene:update-layers",(e=>{const t=e;ge.Z.dispatch((0,ve.OU)(t.layers,t.selecteds))})),be.attach("scene:update-scene_child-prop",(e=>{ge.Z.dispatch((0,ve.N1)(e))})),be.attach("scene:update-scene_child-ui-prop",(e=>{ge.Z.dispatch((0,ve.EY)(e))})),be.attach("timeline:change_status",(e=>{ge.Z.dispatch((0,ye.C3)(e==V.Z.START))})),be.attach("timeline:update_sequence",(e=>{ge.Z.dispatch((0,ve.Tf)(e))})),be.attach("command_history:update_history",(e=>{ge.Z.dispatch((0,ve.ZA)(e))}));const Ee=be,Ze=i.Z.color("dark-lighten").alpha(.9),we=o.ZP.div`
    position: fixed;
    top: ${i.Z.add(2,0)};
    left: ${i.Z.add(2,0)};
    background: ${Ze.toString("rgba")};
    font-size: 1rem;
    border-radius: 2px;
    z-index: 2;
`,xe=o.ZP.li`
    position: relative;
    padding: 0 ${i.Z.ms(0)} 0 ${i.Z.ms(-1)};
    cursor: pointer;

    &:hover { 
        background: ${i.Z.color("dark-verylighten")};
    }

    &:before {
        display: inline-block; 
        vertical-align: middle;
        content: ' ';
        width: 5px;
        height: 5px;
        border-radius: 3px;
        transform: translateY(-2px);
        z-index: 1;
        margin-right: ${i.Z.ms(-1)};
        ${e=>e.current&&"background: #fff;"}
    }
`,ke=(0,r.$j)((e=>({history:e.project.history})))((({history:e})=>{function t(e){Ee.history(e)}let n=!1;return a.createElement(we,null,a.createElement("div",{style:{borderBottom:"1px solid "+i.Z.color("dark-verylighten"),padding:`${i.Z.ms(-1)} ${i.Z.ms(0)}`}},"History"),a.createElement("ul",{style:{margin:0,padding:`${i.Z.ms(-2)} 1px`,listStyle:"none",maxHeight:"70vh",overflow:"auto"}},e.length>0&&e.map((e=>(n=n||e.bLast,a.createElement(xe,{current:e.bLast,key:e.id,onClick:()=>t(e.level)},e.command)))),a.createElement(xe,{current:!n,onClick:()=>t(e.length)},"Original")))}));var _e=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};const Ce=o.ZP.ul`
    background: ${i.Z.color("dark-lighten")};
    line-height: ${i.Z.ms(1)};
    position: absolute;
    margin: 0; 
    padding: ${i.Z.ms(-2)} 1px; 
    top: 100%;
    left: 0;
    list-style: none; 
    transform: translateY(-2px);

    li {
        padding: 0 ${i.Z.ms(0)};
        white-space: nowrap;

        &:hover {
            background: ${i.Z.color("dark-verylighten")}
        }
    }
`,Se=e=>{var{actions:t}=e,n=_e(e,["actions"]);return a.createElement(Ce,null,t.map(((e,t)=>null==e?a.createElement("li",{key:t,style:{height:"1px",lineHeight:0,margin:`${i.Z.ms(-2)} 0`,background:i.Z.color("dark-verylighten").toString()}}):a.createElement("li",{key:t,onClick:()=>e.action(n)},e.name))))},$e=[{name:"Splash Screen",action:()=>{ge.Z.dispatch((0,ye.Tv)())}}];function je(e,t,n=3e3){const{message_id:a}=ge.Z.dispatch((0,ye.PV)(e,t));setTimeout((()=>{ge.Z.dispatch((0,ye.SR)(a))}),n)}var Oe=n(51304),Pe=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function De(e,t,n){console.log({name:e,data:t,mime:n});const a=new Blob([t],{type:n}),r=URL.createObjectURL(a),i=document.createElement("a");i.setAttribute("href",r),i.setAttribute("download",e),i.setAttribute("target","_blank"),document.body.appendChild(i),i.click(),URL.revokeObjectURL(r),i.remove()}function ze(e=!1){return Pe(this,void 0,void 0,(function*(){return new Promise((e=>{const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","."+Oe.Z.file_extension),t.style.position="absolute",t.style.top="-100000",t.style.left="-100000",t.style.display="none",t.addEventListener("change",(n=>Pe(this,void 0,void 0,(function*(){const a=yield function(e){if(e.target.files&&e.target.files.length>0){const t=e.target.files[0],n=new TextDecoder("utf-8");return new Promise((e=>{const a=new FileReader;a.addEventListener("load",(()=>Pe(this,void 0,void 0,(function*(){const t=a.result;try{const a=n.decode(t);e(a)}catch(t){e(null)}}))),{passive:!0}),a.readAsArrayBuffer(t)}))}return Promise.resolve(null)}(n);t.remove(),e(a)}))),{passive:!0}),document.body.appendChild(t),t.click()}))}))}var Ae=n(73935);const Re=document.getElementById("prompt-root"),Te=({onResult:e,label:t,defaultValue:n})=>{const r=a.createRef(),i=a.createRef();function o(){var t;const n=(null===(t=i.current)||void 0===t?void 0:t.value)||"";n.length>0?e(n):s()}function s(){if(r.current){const e=r.current;e.classList.remove("prompt--focus"),setTimeout((()=>{var t;e.classList.add("prompt--focus"),null===(t=i.current)||void 0===t||t.focus(),setTimeout((()=>{e.classList.remove("prompt--focus")}),500)}))}}return a.useEffect((()=>(Re.className="open",document.addEventListener("click",s,{passive:!0}),()=>{Re.className="",document.removeEventListener("click",s)})),[]),a.createElement("div",{ref:r,className:"prompt"},a.createElement("div",{className:"prompt__label"},t),a.createElement("input",{className:"prompt__input",autoFocus:!0,ref:i,defaultValue:n,onFocus:e=>e.target.select(),onKeyDown:e=>13==e.keyCode&&o()}),a.createElement("div",{className:"prompt__confirm_buttons"},a.createElement("button",{className:"prompt__button",onClick:o},"Save"),a.createElement("button",{className:"prompt__button",onClick:()=>e(null)},"Cancel")))},Le=()=>null;const Ie=function(e,t){return new Promise((n=>{Ae.render(a.createElement(Te,{onResult:function(e){n(e),Ae.render(a.createElement(Le,null),Re)},label:e,defaultValue:t}),Re)}))};var Me=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function Fe(e){return Me(this,void 0,void 0,(function*(){const t=yield Ie("Set project name",Oe.Z.empty_project_name);if(null!==t){if(yield Ee.ask("import-json",JSON.stringify({name:t,scene:{},background:i.Z.color("dark").toString("hex"),mainColor:i.Z.color("primary").toString("hex"),sequence:{start:0,end:6e3,durate:6e3,framerate:60}})))return je(t+" created."),void(e&&e());je("creation error")}e&&e()}))}function Be(e=!1,t){return Me(this,void 0,void 0,(function*(){const n=yield ze(e);if(n){if(yield Ee.ask(e?"append-json":"import-json",n))return t&&t(),void je(e?"added to scene":"imported")}je("error import")}))}const Ne=[{name:"New",action:()=>{Fe()}},{name:"Open",action:()=>{Be()}},{name:"Recover",action:()=>{Ee.restoreAutosave()}},{name:"Import",action:()=>{Be(!0)}},{name:"Save",action:({project:e})=>{Ee.autosave(e).then((()=>{je("Save complete")}))}},{name:"Save As",action:({project:e})=>Me(void 0,void 0,void 0,(function*(){const t=yield Ie("Project name",e.name&&e.name.length>0?e.name:Oe.Z.empty_project_name),n=yield Ee.ask("export-json",{name:t}),a=(new TextEncoder).encode(n);De(e.name+"."+Oe.Z.file_extension,a,"application/octet-stream")}))}],He=[{name:"Undo",action:()=>{Ee.undo()}},{name:"Redo",action:()=>{Ee.redo()}},null,{name:"History",action:({setOpenHistory:e})=>{e(!0)}}],qe=[{name:"Render Image",action:()=>{ge.Z.dispatch((0,ye.h7)("render-image"))}},{name:"Render Animation",action:()=>{ge.Z.dispatch((0,ye.h7)("render-animation"))}},{name:"Generate GCODE",action:()=>{ge.Z.dispatch((0,ye.h7)("generate-gcode"))}}],Ue=document.getElementById("prompt-root"),Ve=({onResult:e,label:t,ok:n,no:r})=>{const i=a.createRef();function o(){if(i.current){const e=i.current;e.classList.remove("prompt--focus"),setTimeout((()=>{e.classList.add("prompt--focus"),setTimeout((()=>{e.classList.remove("prompt--focus")}),500)}))}}return a.useEffect((()=>(Ue.className="open",document.addEventListener("click",o,{passive:!0}),()=>{Ue.className="",document.removeEventListener("click",o)})),[]),a.createElement("div",{ref:i,className:"prompt"},a.createElement("div",null,a.createElement("div",{className:"prompt__label"},t),a.createElement("div",{className:"prompt__confirm_buttons"},a.createElement("button",{className:"prompt__button",onClick:()=>e(!0)},n),a.createElement("button",{className:"prompt__button",onClick:()=>e(!1)},r))))},We=()=>null;const Ge=function(e,t="Accept",n="Cancel"){return new Promise((r=>{Ae.render(a.createElement(Ve,{onResult:function(e){r(e),Ae.render(a.createElement(We,null),Ue)},label:e,ok:t,no:n}),Ue)}))};var Ye=n(76554),Xe=n(5661),Ke=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Je=function({project:e,updateProjectProperties:t}){const[n,r]=a.useState({project_id:"",interval:!1}),[i,o]=a.useState(!1);a.useEffect((()=>{function e(e){var t;const n=(null===(t=e.clipboardData)||void 0===t?void 0:t.getData("text"))||"";Xe.Z.isSVG(n)&&ge.Z.dispatch((0,ye.h7)("import-svg",{svg:n}))}return document.addEventListener("paste",e,{passive:!0}),()=>document.removeEventListener("paste",e)}),[]),a.useEffect((()=>{let t=0;return n.interval&&n.project_id===e.id&&(t=window.setTimeout((()=>{(0,Ye.IG)()||(je("autosave"),Ee.autosave(e))}),Oe.Z.autosave_timeout)),()=>{t&&clearTimeout(t)}}),[n,e]),a.useEffect((()=>{function a(a){if(70==a.keyCode&&(0,p.sn)(a))return document.fullscreenElement?document.exitFullscreen():document.body.requestFullscreen(),a.preventDefault();if(i)83==a.keyCode&&(0,p.sn)(a)&&a.preventDefault();else switch(a.keyCode){case 32:Ee.ask("toggle-timeline");break;case 90:(0,p.sn)(a)&&(a.shiftKey?Ee.redo():Ee.undo());break;case 83:(0,p.sn)(a)&&(a.preventDefault(),function(){Ke(this,void 0,void 0,(function*(){const a=Ee.getAutosaveProjectId();if(a&&a!=e.id&&(o(!0),!(yield Ge("Override exist autosave project?","Yes","No"))))return(yield Ge("Restore autosave project?","Yes","No"))&&(r({project_id:a,interval:!0}),Ee.restoreAutosave()),void o(!1);if(void 0===e.name||0===e.name.length){o(!0);const a=yield Ie("Set project name",Oe.Z.empty_project_name);if(null===a)return;t({name:a}),e.name=a,document.title=Oe.Z.getDocumentProjectTitle(a),r(Object.assign({},n)),o(!1)}(e.id!==n.project_id||e.id===n.project_id&&!n.interval)&&r({project_id:e.id,interval:!0}),Ee.autosave(e).then((()=>je(`${e.name} saved`)))}))}())}}return document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}}),[e,n,i])},Qe=o.ZP.ul`
	display: grid;
	grid-template-columns: repeat(4, max-content);
	align-items: center;
	list-style: none;
	margin: 0 ${i.Z.ms(-2)};
	padding: 0 ${i.Z.ms(-2)};
	font-size: 0.8rem;
	line-height: ${i.Z.ms(2)};
	height: 100%;

	li ul {
		display: none;
	}

	${e=>e.enableSubMenu&&"\n        li:hover ul { display: block; }\n    "}
`,et=o.ZP.li`
	position: relative;
	z-index: 10;
	padding: ${i.Z.ms(-2)} ${i.Z.ms(-1)};
	line-height: 1;

	&:hover {
		background: ${i.Z.color("dark-verylighten")};
		border-radius: 2px;
		cursor: pointer;
	}
`,tt=a.memo((0,r.$j)((e=>({project:e.project})),(e=>({updateProjectProperties:t=>e((0,ve.JR)(t))})))((({project:e})=>{const t=a.createRef(),[n,r]=a.useState(!1),[i,o]=a.useState(!1);return a.useEffect((()=>{function e(e){if(e.data&&e.data.event)switch(e.data.event){case"set-popup-window-value":console.log(e.data),Ee.run("set-prop",e.data.value)}}return window.addEventListener("message",e,!1),()=>window.removeEventListener("message",e)}),[]),Je({project:e,updateProjectProperties:ve.JR}),a.useEffect((()=>{let e=0;function a(a){var s;e&&clearTimeout(e),a.target==t.current||(null===(s=t.current)||void 0===s?void 0:s.contains(a.target))?r(!n):(i&&o(!1),n&&r(!1))}function s(a){var i;a.target==(null==t?void 0:t.current)||(null===(i=null==t?void 0:t.current)||void 0===i?void 0:i.contains(a.target))?e&&clearTimeout(e):!e&&(e=window.setTimeout((()=>{n&&r(!1)}),1e3))}return document.addEventListener("mousemove",s,{passive:!0}),document.addEventListener("click",a,{passive:!0}),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("click",a)}}),[n,t,i]),a.createElement("nav",{role:"navigation",ref:t},a.createElement(Qe,{enableSubMenu:n},a.createElement(et,null,a.createElement("img",{src:"assets/images/logo-full.svg",style:{height:"18px",display:"inline-block",verticalAlign:"middle"}}),a.createElement(Se,{actions:$e})),a.createElement(et,null,a.createElement("div",null,"File"),a.createElement(Se,{actions:Ne,project:e})),a.createElement(et,null,a.createElement("div",null,"Edit"),a.createElement(Se,{actions:He,setOpenHistory:o})),a.createElement(et,null,"Render",a.createElement(Se,{actions:qe}))),i&&a.createElement(ke,null))})));var nt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};const at=o.F4`
    0%{ opacity: 0; }
    100%{ opacity: 1; }
`,rt=i.Z.color("dark").lighten(10),it=o.ZP.div`
    position: absolute;
    text-align: left;
    background: ${rt};
    font-size: ${e=>e.small?".7rem":".8rem"};
    padding: ${i.Z.ms(-3)} ${i.Z.ms(-2)};
    line-height: 1.2;
    border-radius: 4px;
    opacity: 0;
    pointer-events: none;
    z-index: 1000;
    white-space: pre;

    &:after{
        position: absolute;
        display: block;
        line-height: 0;
        font-size: 0;
        content: ' ';
    }

    ${e=>{switch(e.position){case"bottom":return`\n                top: 120%;\n                left: 50%;\n                transform: translate(-50%, 0);\n                \n                &:after {\n                    left: 50%;\n                    bottom: 100%;\n                    transform: translate(-50%, 0%);\n                    border-bottom: 6px solid ${rt};\n                    border-left: 5px solid transparent;\n                    border-right: 5px solid transparent;\n                }\n            `;case"left":return`\n                top: 50%;\n                right: 120%;\n                transform: translate(0%, -50%);\n                \n                &:after {\n                    left: 100%;\n                    top: 50%;\n                    transform: translate(0%, -50%);\n                    border-left: 6px solid ${rt};\n                    border-top: 5px solid transparent;\n                    border-bottom: 5px solid transparent;\n                }\n            `;case"right":return`\n                top: 50%;\n                left: 120%;\n                transform: translate(0%, -50%);\n                \n                &:after {\n                    right: 100%;\n                    top: 50%;\n                    transform: translate(0%, -50%);\n                    border-right: 6px solid ${rt};\n                    border-top: 5px solid transparent;\n                    border-bottom: 5px solid transparent;\n                }\n            `;case"top":return`\n                bottom: 120%;\n                left: 50%;\n                transform: translate(-50%, 0);\n                \n                &:after {\n                    left: 50%;\n                    top: 100%;\n                    transform: translate(-50%, 0%);\n                    border-top: 6px solid ${rt};\n                    border-left: 5px solid transparent;\n                    border-right: 5px solid transparent;\n                }\n            `}}}
`,ot=o.ZP.div`
    position: relative;
    &:hover ${it} { 
        animation: ${e=>e.disabled?null:at} .1s .3s linear both;
    }
`,st=a.memo((e=>{var{disabled:t,small:n,position:r,title:i,children:o}=e,s=nt(e,["disabled","small","position","title","children"]);return a.createElement(ot,Object.assign({disabled:t},s),a.createElement(it,{small:n||!1,position:r||"top",dangerouslySetInnerHTML:{__html:i}}),o)}));var lt=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const ct=a.memo((e=>a.createElement(st,{title:"Processing",style:{height:"100%"}},a.createElement("svg",{style:{height:"100%",opacity:e.visible?1:.001,transition:"opacity .1s"},viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},a.createElement("circle",{cx:"50",cy:"50",r:"37",strokeWidth:"10",stroke:"#ffffff",strokeDasharray:"58.119464091411174 58.119464091411174",fill:"none",strokeLinecap:"round",transform:"rotate(66.0614 50 50)"},a.createElement("animateTransform",{attributeName:"transform",type:"rotate",repeatCount:"indefinite",dur:"1s",keyTimes:"0;1",values:"0 50 50;360 50 50"}))))));ct.displayName="Loading";const dt={color:"rgba(255,255,255,.4)",background:i.Z.color("dark").toString("hex"),display:"flex",gap:i.Z.ms(-1),padding:`0 ${i.Z.ms(-1)}`,alignItems:"center",fontSize:".8rem",height:"100%"},mt=a.memo((()=>{const e=(0,p.tg)(),[t,n]=a.useState(!1),[r,i]=a.useState(0),o=document.getElementById("workspace");return a.useEffect((()=>{o&&(document.documentElement.style.cursor=t?"wait":"auto",o.style.pointerEvents=t?"none":"auto")}),[t]),a.useEffect((()=>{let e=0,t=performance.now();function a(){return setTimeout((()=>lt(this,void 0,void 0,(function*(){const e=yield Ee.ask("scene-points");e!=r&&i(e)}))))}return Ee.attach("executor-work",(e=>{const a=performance.now();(a-t>300||0==e.waiting)&&(t=a,n(e.waiting>0))})),Ee.attach("project:update-properties",(t=>{t.ghosts&&(e=a())})),Ee.attach("scene:update-layers",(t=>{e=a()})),Ee.attach("drawer:update",(t=>{e=a()})),Ee.attach("scene:update-scene_child-prop",(t=>{for(let n=0,r=t.length;n<r;n++)if("repetitions"===t[n].name||"shape"===t[n].name)return e=a()})),a(),()=>{e&&clearTimeout(e)}}),[]),a.createElement("div",{style:dt},a.createElement("div",null,e?"Run on web worker":"Run in local"),a.createElement(ct,{visible:t}),a.createElement("div",{style:{justifySelf:"flex-end",flex:5,textAlign:"right"}},a.createElement("div",null,"Number of points: ",r)))})),ut={position:"fixed",bottom:0,left:0,listStyle:"none",margin:0,padding:0},pt=o.F4`
    from { transform: translate(0%, 0%) scale(.8); }
    to { transform: translate(0%, 0%) scale(1); }
`,ht=o.ZP.li`
    background: ${i.Z.color("secondary")};
    color: #fff;
    padding: ${i.Z.ms(-1)};
    margin: ${i.Z.ms(-1)};
    transform-origin: left center;
    animation: ${pt} .1s ease-out both;
`,ft=(0,r.$j)((e=>({messages:e.app.messages})))((({messages:e})=>{const t=Object.values(e).reverse();return a.createElement("ul",{style:ut},t.map((e=>a.createElement(ht,{key:e.id},e.message))))})),gt={position:"relative",border:`1px solid ${i.Z.color("dark-lighten")}`,width:i.Z.add(2,0),borderRadius:"2px",maxHeight:"70vh"},vt={listStyle:"none",margin:0,padding:0,width:"100%"},yt=o.ZP.li`
	position: relative;
	width: 100%;
	cursor: pointer;
	padding: ${i.Z.div(1,"2rem")};

	&:hover img {
		filter: hue-rotate(180deg);
	}

	& + & {
		margin-top: 1px;
	}
`,bt=()=>{const[e,t]=a.useState([]);a.useEffect((()=>{Ee.ask("toolbar",{size:128,color:i.Z.color("primary").toString("hex")}).then(t)}),[]);return a.createElement("section",{"data-name":"toolbar",style:gt},a.createElement("ul",{style:vt},e.map(((e,t)=>a.createElement(yt,{key:t,onClick:()=>{return t=e.name,void Ee.run("add",{type:t});var t}},a.createElement(st,{title:`Add <i><b>${e.name}</b></i> shape to Scene`,position:"right"},a.createElement("img",{src:e.image,style:{width:"100%"}})))))))};var Et=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};const Zt=e=>{var{columns:t,rows:n,flow:r,gap:i,halign:o,valign:s,style:l,children:c,component:d}=e,m=Et(e,["columns","rows","flow","gap","halign","valign","style","children","component"]);const u=void 0===t&&void 0===n||void 0!==t&&void 0!==n?"gridTemplate":t>=0?"gridTemplateColumns":"gridTemplateRows",p=r||(t&&n?`repeat(${n}, 1fr) / repeat(${t}, 1fr)`:`repeat(${t||n}, 1fr)`),h=Object.assign({display:"grid",[u]:p,gap:i,alignItems:s,justifyContent:o},l);return a.createElement(d||"div",Object.assign({style:h},m),c)},wt={display:"inline-block",overflow:"hidden",borerRadius:"2px"},xt={position:"relative",width:"100%",height:"100%",margin:"-1px",transformOrigin:"left top",background:"rgba(255,255,255,.2)"},kt=a.memo((({scale:e,translate:t,height:n})=>{const r=parseFloat(n),o=r/e/2,s={border:`1px solid ${e>1?i.Z.color("primary"):i.Z.color("primary").alpha(.4).toString("rgba")}`,width:r+"rem",height:r+"rem"},l={top:(0,E.Sr)(-1,1,t[1],o,r-o)+"rem",left:(0,E.Sr)(-1,1,t[0],o,r-o)+"rem",transform:`scale(${1/e}) translate(-50%, -50%)`};return a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center"},gap:i.Z.ms(-2)},a.createElement("small",null,a.createElement(st,{small:!0,title:"Use wheel on drawer for zoom\nand drag for translate"},a.createElement("span",{style:{color:1!==e?i.Z.color("primary").toString("hex"):""}},"Zoom"))),a.createElement("div",{style:Object.assign(Object.assign({},s),wt)},a.createElement("div",{style:Object.assign(Object.assign({},l),xt)})))}));var _t=n(99011);const Ct=a.memo((()=>{const[e,t]=a.useState(0);return a.useEffect((()=>{Ee.ask("set-drawer-lines",e)}),[e]),a.useEffect((()=>{let t=!0;function n(n){t=!t,72==n.keyCode&&Ee.ask("set-drawer-lines",t?e:0)}return document.addEventListener("keydown",n,{passive:!0}),()=>document.removeEventListener("keydown",n)}),[e]),a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center"},gap:i.Z.ms(-2)},a.createElement("small",null,"Lines"),a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement(_t.Z,{size:0,rotate:180,name:"arrow-right",onClick:()=>t((0,E.uZ)(0,20,e-1))}),a.createElement("small",null,e),a.createElement(_t.Z,{size:0,name:"arrow-right",onClick:()=>t((0,E.uZ)(0,20,e+1))})))}));var St=n(62957),$t=n(27106),jt=n(73259),Ot=n(84581);const Pt=a.memo((({offsets:e,ratio:t,setSize:n,setOffsets:r})=>{const[i,o]=a.useState([0,0]),[s]=(0,St.Z)(),l=a.useRef(null),c=(0,Ot.Z)({onDrag:t=>{e.translate=[(0,E.uZ)(-1,1,i[0]+t.x/-100/e.scale),(0,E.uZ)(-1,1,i[1]+t.y/-100/e.scale)],1==e.scale&&(e.translate=[0,0]),Ee.ask("set-drawer-offsets",e),r(Object.assign({},e))},onDragEnd:()=>{o([...e.translate])}}),d=(0,$t.Z)(l),m=Math.floor(Math.min(d.width,d.height));return(0,jt.Z)(c,((t,n)=>{n.preventDefault();const a=e.scale;e.scale=(0,E.uZ)(1,10,a+-1*Math.sign(t)*(n.shiftKey?1:n.altKey?.01:.1)),1==e.scale&&(e.translate=[0,0]),Ee.ask("set-drawer-offsets",e),r(Object.assign({},e))})),a.useEffect((()=>{c.current&&s.current&&m>0&&(r(Object.assign(Object.assign({},e),{size:m})),Ee.setDrawer(s.current,m,t,ue.Z.get("resolution","high")),c.current.style.width=m+"px",c.current.style.height=m+"px",n(m))}),[m]),a.useEffect((()=>{if(s.current&&m>0){let e=t>=1?m:m*t,n=t>=1?m/t:m;if(e>m){const t=e/n;e=m,n=m/t}else if(n>m){const t=n/e;n=m,e=m/t}s.current.style.width=e+"px",s.current.style.height=n+"px",s.current.style.maxWidth=e+"px",s.current.style.maxHeight=n+"px",s.current.style.minWidth=e+"px",s.current.style.minHeight=n+"px"}}),[m,t]),a.createElement("div",{ref:l,style:{width:"100%",height:"100%",overflow:"hidden",display:"flex",justifyContent:"center"}},a.createElement("div",{ref:c,style:{background:"#000",display:"flex",justifyContent:"center",alignItems:"center"}},a.createElement("canvas",{ref:s,style:{pointerEvents:"none",maxWidth:"100%",maxHeight:"100%"}})))}));var Dt=n(21680);const zt=a.memo((({clear:e,ghosts:t})=>a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center",opacity:t>0?.2:1,pointerEvents:t>0?"none":void 0},gap:i.Z.ms(-2)},a.createElement("small",null,a.createElement("label",{style:{cursor:"pointer",color:0!==t||e?"":i.Z.color("primary").toString("hex")},htmlFor:"cb_clear"},"Clear")),a.createElement(Dt.Z,{size:1,checked:e,id:"cb_clear",onChange:e=>Ee.ask("set-drawer-clear",e)})))),At={passive:!0,once:!1,capture:!1},Rt={};function Tt(e,t){return e.passive==t.passive&&e.capture==t.capture&&e.once==t.once}function Lt(e,t,n=At){const a=Object.assign(Object.assign({},At),n||{});("string"==typeof e?[e]:e).forEach((e=>{if(e in Rt){let n=!1;for(let r=0,i=Rt[e].length;r<i;r++){const i=Rt[e][r];if(Tt(a,i.options)){i.callbacks.push(t),n=!0;break}}n||Rt[e].push({options:a,callbacks:[t],handler:Mt(e,a)})}else Rt[e]=[{options:a,callbacks:[t],handler:Mt(e,a)}]}))}function It(e,t,n=At){const a="string"==typeof e?[e]:e,r=Object.assign(Object.assign({},At),n||{});a.forEach((e=>{if(e in Rt){for(let n=0,a=Rt[e].length;n<a;n++){const a=Rt[e][n];if(Tt(r,a.options)&&(a.callbacks.splice(a.callbacks.indexOf(t),1),0===a.callbacks.length)){window.removeEventListener(e,a.handler),Rt[e].splice(n,1);break}}0==Rt[e].length&&delete Rt[e]}}))}function Mt(e,t){function n(n){if(e in Rt){Rt[e].forEach((e=>{Tt(e.options,t)&&e.callbacks.forEach((e=>e(n)))}))}}return window.addEventListener(e,n,t),n}const Ft=function(){return[Lt,It]},[Bt]=Ft();let Nt;const Ht=[];function qt(e){if(e==Nt)return!1;const t=document.createElement("textarea");return t.value=e||"",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),!0}Bt(["cut","copy"],(function(){const e=window.getSelection();Nt=e?e.toString():void 0,Ht.forEach((e=>e(Nt)))}),{passive:!0});const Ut=function(){const[e,t]=a.useState(Nt);return a.useEffect((()=>{function e(e){t(e)}return Ht.push(e),()=>{Ht.splice(Ht.indexOf(e,1))}}),[]),[e,qt]},Vt={backgroundImage:"url(assets/images/png-background.png)",backgroundPosition:"center center",backgroundSize:"cover",position:"relative",borderRadius:"4px",display:"inline-block",verticalAlign:"middle"},Wt={position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:"2px"},Gt=a.memo((({color:e,clipboard:t,size:n,onClick:r})=>{let o,s;return(t=void 0===t||t)&&([o,s]=Ut()),n="string"==typeof n?n:i.Z.ms(n||0),a.createElement("div",{style:Object.assign(Object.assign({},Vt),{width:n,height:n,cursor:r?"pointer":void 0})},a.createElement("div",{style:Object.assign(Object.assign({},Wt),{background:e}),onClick:function(n){!1!==(r&&r(n))&&t&&s(e)&&je(`Copy ${e} to clipboard.`)}}))})),Yt=({children:e,container:t})=>Ae.createPortal(e,"string"==typeof t?document.querySelector(t):t);var Xt=n(72995),Kt=n(38166);const Jt=o.ZP.div`
    position: relative;
    line-height: 0;
    
    ${e=>e.vertical?`\n        width: ${i.Z.ms(0)};\n        min-height: ${i.Z.ms(4)};\n        height: 100%;  \n        padding: ${i.Z.div(0,"1.6rem")} 0;\n        transform: scale(-1);\n\n        > div { transform: translate(0%, -50%) scale(-1.2); }\n        cursor: n-resize;\n    `:`\n        height: ${i.Z.ms(0)};\n        min-width: ${i.Z.ms(4)};\n        width: 100%;  \n        padding: 0 ${i.Z.div(0,"1.6rem")};\n\n        > div { transform: translate(-50%, 0) scale(1.2); }\n        cursor: e-resize;\n    `}
    border-radius: ${i.Z.ms(0)};
    background: ${i.Z.color("dark","hex")};
    

        
    &:hover > div{
        background: ${i.Z.color("dark-lighten").lighten(10)};
    }
`,Qt=o.ZP.div`
    position: absolute;
    height: ${i.Z.ms(0)};
    width: ${i.Z.ms(0)};
    border-radius: ${i.Z.ms(0)};
    background: ${i.Z.color("dark-lighten")};
    box-shadow: 0 0 4px 1px rgba(0,0,0, .6);
    pointer-events: none;

    > small {
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translate(-50%, -${i.Z.add(-2,"2px")});
        line-height: 1;
        background: ${i.Z.color("dark-lighten").lighten(10)};
        padding: ${i.Z.ms(-3)} ${i.Z.ms(-2)};
        border-radius: 2px;

        &:after{
            display: block;
            content: ' ';
            clear: both;
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translate(-50%, -2px);
            border-top: 6px solid ${i.Z.color("dark-lighten").lighten(10)};
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
        }
    }
`,en=a.memo((({value:e,step:t,min:n,max:r,onChange:i,vertical:o})=>{const s=t.toExponential(1).match(/e(-?[0-9]+)/),l=Math.pow(10,s?-s[1]:0),[c,d]=a.useState(!1),[m,u]=(0,Kt.Z)({value:e,vertical:o,step:t,exp:l,min:n,max:r,onChange:i,events:{drag:()=>d(!0)}});return a.createElement(Jt,{vertical:o,ref:u,onMouseOver:()=>!c&&d(!0),onMouseOut:()=>c&&d(!1)},a.createElement(Qt,{style:{[o?"top":"left"]:m.valuePercentage+"%"}},a.createElement("small",{style:{display:c?"block":"none"}},m.value.toFixed(Math.log10(l)))))}));var tn=n(4598);function nn(e){try{return new tn.default(e).toRGBA().replace(/ /gi,"")}catch(e){}return null}function an(e,t,n,a){const r=a/2,i=(Math.atan2(e.y-r,e.x-r)+Math.PI)/(2*Math.PI),o=Math.sqrt((e.x-r)*(e.x-r)+(e.y-r)*(e.y-r))/r;return new tn.default(`rgba(${rn(i,o,t/100).join(",")},${Math.round(100*n)/100})`).toHSLA()}function rn(e,t,n){let a=0,r=0,i=0;const o=Math.floor(6*e),s=6*e-o,l=n*(1-t),c=n*(1-s*t),d=n*(1-(1-s)*t);switch(o%6){case 0:a=n,r=d,i=l;break;case 1:a=c,r=n,i=l;break;case 2:a=l,r=n,i=d;break;case 3:a=l,r=c,i=n;break;case 4:a=d,r=l,i=n;break;case 5:a=n,r=l,i=c}return[a,r,i].map((e=>(0,E.uZ)(0,255,Math.round(255*e))))}const on={position:"relative",borderRadius:" 50%",overflow:"hidden",cursor:"pointer",border:`1px solid ${i.Z.color("dark").darken(5)}`},sn={cursor:"pointer",borderRadius:"50%",border:"2px solid",width:"12px",height:"12px",top:"-7px",left:"-7px",zIndex:1,backfaceVisibility:"hidden",transition:"border-color .3s ease-in",pointerEvents:"none"},ln=a.memo((({color:e,coords:t,value:n,alpha:r,onChange:o,wheelSize:s})=>{const l=(0,Ot.Z)({onDrag(e,t){const a={x:t.x-c.x,y:t.y-c.y};o(an(a,n,r,s),"slider")},onDragEnd(e,t){const a={x:t.x-c.x,y:t.y-c.y};o(an(a,n,r,s),"none")}}),c=(0,$t.Z)(l);return a.useEffect((()=>{if(l.current){const e=l.current.getContext("2d");e&&e.putImageData(function(e,t){const n=t/2,a=new ImageData(t,t),r=a.data;for(let a=-n;a<n;a++)for(let i=-n;i<n;i++){const o=Math.sqrt(a*a+i*i),s=Math.atan2(i,a);if(o>n)continue;const l=(s+Math.PI)/(2*Math.PI),c=4*(a+n+(i+n)*t),[d,m,u]=rn(l,o/n,e/100);r[c]=d,r[c+1]=m,r[c+2]=u,r[c+3]=255}return a}(n,s),0,0)}}),[n,l.current]),a.createElement("div",{style:Object.assign(Object.assign({},on),{width:s+"px",height:s+"px"})},a.createElement("div",{style:Object.assign(Object.assign({},sn),{position:"absolute",background:e,transform:`translate(${t.x}px, ${t.y}px)`,borderColor:n>50?i.Z.color("dark").toString():"#ffff"})}),a.createElement("canvas",{ref:l,width:s,height:s,style:{width:s+"px",height:s+"px",transform:"scale(1.025)"}}))})),cn=o.ZP.input`
    width: ${i.Z.add(4,2)};
    padding: ${i.Z.ms(-3)} ${i.Z.ms(-2)};
    background: ${i.Z.palette.get("dark","hex").darken(5)};
    border:none;
    font-size: 1rem;
    color: #fff;
`,dn=o.ZP.div`
    cursor: pointer;
    color: rgba(255,255,255,.3);
    &:hover {
        color: rgba(255,255,255,.6);
    }
`,mn=a.memo((({color:e,onChange:t})=>{const n=a.useRef(null),[r]=Ut(),o=r?nn(r):null;function s(){if(n.current&&n.current.value.length>0){const a=nn(n.current.value);a&&a!=e&&(n.current.value="",t(a))}}return a.createElement(Zt,{columns:3,flow:"repeat(3, max-content)",valign:"center",gap:i.Z.ms(-1),style:{width:"100%"}},a.createElement(cn,{ref:n,placeholder:"Insert color",onKeyUp:e=>13==e.keyCode&&s()}),a.createElement(dn,{onClick:()=>s()},"Add"),o?a.createElement(Gt,{onClick:()=>t(o),color:o,clipboard:!1}):a.createElement("div",{style:{width:i.Z.ms(0),height:i.Z.ms(0)}}))})),un=140,pn={position:"fixed",background:`${i.Z.color("dark").lighten(2)}`,border:`1px solid ${i.Z.color("dark").lighten(10)}`,borderRadius:"2px",padding:`${i.Z.ms(0)}`,userSelect:"none",lineHight:i.Z.ms(0)},hn=o.ZP.div`
    position: relative;
    margin-left: ${i.Z.sub(0,-3)};
    padding-left: ${i.Z.add(-1)};
`,fn=o.ZP.div`
    position: absolute;
    font-size: .8rem;
    transform: translate(-50%, -50%) rotate(-90deg);
    left: 0;
    top: 50%;
`,gn=a.memo(a.forwardRef(((e,t)=>{if(!e.position)return null;const n=e.color?e.color:"#fff",r=function(e,t){const n=new tn.default(e),{h:a,s:r,v:i}=n.getHsv(),o=r*t/2,s=2*a*Math.PI-Math.PI;return{value:Math.round(100*i),alpha:n.getAlpha(),hue:a,saturation:r,coords:{x:o*Math.cos(s)+t/2,y:o*Math.sin(s)+t/2}}}(n,un),o=(0,Xt.Z)(),s=e.position.x>o.width-238?e.position.x-238:e.position.x,l=e.position.y>o.height-238?e.position.y-238:e.position.y;return a.createElement(Yt,{container:"#picker-root"},a.createElement("div",{ref:t,style:{position:"relative",zIndex:1e3}},a.createElement(Zt,{rows:3,gap:i.Z.ms(0),flow:"repeat(3, 'max-content')",style:Object.assign(Object.assign({},pn),{top:`${l}px`,left:`${s}px`})},a.createElement("div",{style:{display:"flex"}},a.createElement(ln,{wheelSize:un,color:n,onChange:e.onChange,coords:r.coords,value:r.value,alpha:r.alpha}),a.createElement(hn,null,a.createElement(fn,null,"Value"),a.createElement(en,{min:0,max:100,step:1,vertical:!0,value:r.value,onChange:function(t,a){const i=an(r.coords,t,r.alpha,un);i!=n&&e.onChange(i,a)}})),e.enableAlpha&&a.createElement(hn,null,a.createElement(fn,null,"Alpha"),a.createElement(en,{min:0,max:1,step:.01,vertical:!0,value:r.alpha,onChange:function(t,a){const i=an(r.coords,r.value,t,un);i!=n&&e.onChange(i,a)}}))),a.createElement("div",null,a.createElement(Gt,{color:n}),a.createElement("small",{style:{marginLeft:i.Z.ms(-2)}},n)),a.createElement("div",null,a.createElement(mn,{color:n,onChange:function(t){t!=n&&e.onChange(t,"none")}})))))}))),vn=a.memo((({value:e,enableAlpha:t,size:n,onChange:r})=>{const[i,o]=a.useState(e),[s,l]=a.useState(null),c=a.useRef(null),d=a.useRef(null);return a.useEffect((()=>{function t(e){var t,n;(0,p.sn)(e)||e.target!=c.current&&!(null===(t=c.current)||void 0===t?void 0:t.contains(e.target))&&e.target!=d.current&&!(null===(n=d.current)||void 0===n?void 0:n.contains(e.target))?null!=s&&l(null):null==s&&l({x:e.clientX+12,y:e.clientY+12})}return e!=i&&o(e),document.addEventListener("mousedown",t,{passive:!0}),()=>document.removeEventListener("mousedown",t)}),[e,c.current,d.current,s]),a.createElement(a.Fragment,null,a.createElement("div",{ref:c,style:{display:"flex",alignItems:"center"}},a.createElement(Gt,{size:n,color:i,onClick:e=>!!(0,p.sn)(e)&&void 0})),a.createElement(gn,{ref:d,enableAlpha:null==t||t,position:s,color:i,onChange:function(e,t){"slider"==t&&o(e),r(e,"slider"==t)}}))}));var yn=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};function bn(e,t,n,a=1,r=1){return new Promise((i=>{const o=new Image;o.onload=()=>yn(this,void 0,void 0,(function*(){const e=t?yield function(e,t,n,a=1,r=1){return new Promise((i=>{const o=document.createElement("canvas"),s=o.getContext("2d");o.width=t,o.height=t,s.globalAlpha=a;const l="none"==n?1:Math["adapt"==n?"min":"max"](o.width/e.width,o.height/e.height),c="none"==n?0:o.width/2-e.width/2*l,d="none"==n?0:o.height/2-e.height/2*l;s.drawImage(e,c,d,e.width*l,e.height*l);const m=new Image;m.onload=()=>i(m),m.src=o.toDataURL("image/png",r)}))}(o,t,n,a,r):o;if((0,p.tg)()){const t=yield createImageBitmap(e);i({image:t,source:e.src})}else i({image:e,source:e.src})})),o.src=e}))}var En=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Zn=a.memo((({background:e,backgroundImage:t})=>{const[n,r]=a.useState(!0);return a.useEffect((()=>{n&&t&&function(e){En(this,void 0,void 0,(function*(){if(null===e)Ee.ask("set-background-image",{image:null,source:null});else{const{image:t,source:a}="string"==typeof e?yield bn(e,n?null:1080,"fill",1):e;n&&r(!1),Ee.ask("set-background-image",{image:t,source:a})}}))}(t)}),[t,n]),a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center"},gap:i.Z.ms(-2)},a.createElement("small",null,"Background"),a.createElement(vn,{enableAlpha:!1,hideColorName:!0,size:1,onChange:(e,t)=>{Ee.ask("set-scene-background",{background:e,preventDispatch:t})},value:e}))})),wn=a.memo((({clear:e,ghostSkipTime:t,ghosts:n})=>{function r(e=n,a=t){((e=e<0?0:e)>=0&&e!=n||a!=t)&&Ee.ask("set-drawer-ghosts",{ghosts:e,ghostSkipTime:a})}function o(e,t,n,a=1){return Math.floor((e.shiftKey?t:1)*(e.ctrlKey?n:1))*(e.altKey?a:1)}return a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center",pointerEvent:e?"":"none",opacity:e?"":".2"},gap:i.Z.ms(-2)},a.createElement("small",{style:{color:n>0?i.Z.color("primary").toString("hex"):""}},"Ghosts"),a.createElement("div",{style:{textAlign:"center"}},a.createElement(st,{title:"Number of ghosts"},a.createElement(_t.Z,{size:0,rotate:180,name:"arrow-right",onClick:e=>r(n-o(e,5,10),t)}),a.createElement("small",null,n||0),a.createElement(_t.Z,{size:0,name:"arrow-right",onClick:e=>r(n+o(e,5,10),t)})),a.createElement(st,{title:"Ghost frame skip"},a.createElement(_t.Z,{size:0,rotate:180,name:"arrow-right",onClick:e=>r(n,t-o(e,100,10,.1))}),a.createElement("small",null,t||1),a.createElement(_t.Z,{size:0,name:"arrow-right",onClick:e=>r(n,t+o(e,100,10,.1))}))))}));var xn=n(62368);const kn=[{key:"1:1",value:1},{key:"4:3",value:4/3},{key:"3:2",value:1.5},{key:"1.85:1",value:1.85},{key:"2.39:1",value:2.39},{key:"16:9",value:16/9},{key:"A4 (v)",value:210/297},{key:"A4 (h)",value:297/210},{key:"9:16",value:9/16},{key:"10:16",value:.625}],_n=a.memo((({ratio:e,size:t,resolution:n})=>a.createElement(Zt,{rows:2,flow:"max-content auto",style:{justifyItems:"center"},gap:i.Z.ms(-2)},a.createElement("small",null,"Aspect Ratio"),a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement("small",null,a.createElement(xn.Z,{width:"6rem",position:"top",options:kn,value:e,onChange:e=>function(e){Ee.ask("set-drawer-ratio",{ratio:e,size:t,resolution:n})}(e),placeholder:"Resolution"})))))),Cn=a.memo((0,r.$j)((e=>({backgroundImage:e.project.backgroundImage,background:e.project.background,clear:e.project.clear,ghosts:e.project.ghosts,ghostSkipTime:e.project.ghostSkipTime,ratio:e.project.ratio})))((({background:e,clear:t,backgroundImage:n,ghostSkipTime:r,ghosts:o,ratio:s})=>{const[l,c]=a.useState(0),[d,m]=a.useState(ue.Z.get("resolution","high")),[u,p]=a.useState({scale:1,translate:[0,0],size:400});return a.createElement(Zt,{component:"section","data-name":"drawer",rows:2,gap:i.Z.ms(0),flow:"auto max-content",style:{width:"100%",height:"100%",overflow:"hidden"}},a.createElement(Pt,{setSize:c,ratio:s,offsets:u,setOffsets:p}),a.createElement(Zt,{columns:7,gap:i.Z.ms(0),flow:"repeat(7, max-content)",halign:"center",valign:"start"},a.createElement(kt,Object.assign({height:i.Z.ms(1)},u)),a.createElement(Zn,{offsets:u,background:e,backgroundImage:n}),a.createElement(zt,{ghosts:o,clear:t}),a.createElement(wn,{clear:t,ghosts:o,ghostSkipTime:r}),a.createElement(Ct,null),a.createElement(_n,{ratio:s,size:l,resolution:d})))})));function Sn(e){return(Math.round(e/10)/100).toFixed(2)+"s"}const $n=o.ZP.div`
	line-height: 1;
`,jn=o.ZP.div`
	display: flex;
	position: relative;
	height: 0.8rem;
	width: 100%;
	margin: ${i.Z.ms(-2)} 0;

	> span {
		position: absolute;
		transform: translate(-50%, 0);
	}
`,On=o.ZP.div`
	display: flex;
`,Pn=o.ZP.div`
	display: flex;
	justify-content: space-between;
	height: ${i.Z.ms(0)};

	> span {
		position: absolute;
		height: 100%;
		width: 6px;
		transform: translate(-50%, 0);

		&:after  {
			position: absolute;
			top: 0;
			left: 2.5px;
			width: 1px;
			height: 100%;
			display: block;
			content: ' ';
		}
		&:nth-child(2n + 1):after {
			background: rgba(255, 255, 255, 0.05);
		}
		&:nth-child(2n):after {
			background: rgba(0, 0, 0, 0.2);
		}
	}
`,Dn=o.ZP.div`
	position: relative;
	background: ${i.Z.color("dark-lighten")};
`,zn=o.ZP.div`
	position: absolute;
	top: -${i.Z.ms(-2)};

	&:after {
		position: absolute;
		top: 0;
		display: block;
		content: ' ';
		width: 1px;
		height: ${i.Z.add(0,-2)};
		background: ${i.Z.color("primary")};
	}
`,An=o.ZP.div`
	position: absolute;
	bottom: 100%;
	background: ${i.Z.color("primary")};
	padding: ${i.Z.ms(-3)};
	font-weight: 600;
	transform: translateX(-50%);
	border-radius: 2px;
`,Rn=a.memo((({sequence_duration:e,sequence_framerate:t,current_time:n,renderedFrames:r,steps:o,enableMoveTime:s,onChange:l})=>{const c=Math.floor(e/1e3*t),d=a.useRef(),{width:m}=(0,$t.Z)(d),u=new Array(o).fill(0).map(((t,n)=>a.createElement("span",{key:n,onClick:()=>h(n*e/o),style:{left:n*(100/o)+"%"}},Sn(n*e/o)))),p=new Array(2*o+1).fill(0).map(((t,n)=>a.createElement("span",{style:{left:n*(100/(2*o))+"%"},onClick:()=>h(n*(e/(2*o))),key:n})));function h(t){const a=(0,E.uZ)(0,e,t);a!==n&&l(a)}const f=(0,Ot.Z)({onDrag:t=>{const a=n+(0,E.uZ)(0,m,Math.abs(t.x))*Math.sign(t.x)/m*e,r=(0,E.uZ)(0,e,a);s&&h(r)}});return a.createElement($n,null,a.createElement(jn,null,u,a.createElement("span",{style:{left:"100%"}},Sn(e))),a.createElement(Dn,{ref:d},a.createElement(On,null,new Array(c).fill(0).map(((e,t)=>a.createElement("div",{key:t,style:{width:100/c+"%",height:"1px",background:r.includes(t)?i.Z.color("primary").toString("hex"):""}})))),a.createElement(Pn,null,p),a.createElement(zn,{style:{left:(0,E.Sr)(0,e,n,0,100)+"%"}},a.createElement(An,{style:{cursor:s?"ew-resize":"not-allowed"},ref:f},Sn(n)))))}));var Tn=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Ln={position:"relative",padding:`${i.Z.ms(0)} ${i.Z.ms(1)}`,width:"100%",fontSize:".8rem",border:`1px solid ${i.Z.color("dark-lighten")}`,borderBottomWidth:0,borderRadius:"2px 0 0 2px",transform:""},In=a.memo((0,r.$j)((e=>({sequence:e.project.sequence,bEnableMoveBar:e.project.clear||void 0!==typeof e.project.ghosts&&e.project.ghosts>0,ghosts:e.project.ghosts,bTimelineStarted:e.app.bTimelineStarted})))((({sequence:e,bEnableMoveBar:t,bTimelineStarted:n})=>{const r=new Array(15).fill(0).map(((e,t)=>({key:t+1+"s",value:t+1}))),o=[10,24,30,60,120,144].map((e=>({key:e,value:e}))),[s,l]=a.useState({current_frame:0,current_time:0,fps:e.framerate}),[c,d]=a.useState([]),[m,u]=a.useState(!1);a.useEffect((()=>{if(Ee.attach("timeline:progress",(e=>{l(e)})),te.Z.level<te.i.ComunicationResponse){const e=setInterval((()=>Tn(void 0,void 0,void 0,(function*(){const e=yield Ee.ask("get-rendered-frames");d(e)}))),500);return()=>{clearInterval(e)}}}),[]),a.useEffect((()=>{const e=()=>!m&&u(!0),t=()=>m&&u(!1);return Ee.attach("drawer-canvas:buffer_loaded",e),Ee.attach("drawer-canvas:buffer_flush",t),()=>{Ee.detach("drawer-canvas:buffer_loaded",e),Ee.detach("drawer-canvas:buffer_flush",t)}}),[m]);const p=Math.round(e.framerate/(s.fps||1)*100)/100;return a.createElement("section",{"data-name":"timeline",style:Ln},a.createElement("div",{style:{position:"absolute",left:i.Z.ms(0),top:i.Z.ms(0),display:"flex"}},m||1===p?"realtime":`${p}x slow`),a.createElement("div",{style:{display:"flex",justifyContent:"center",marginBottom:i.Z.ms(0)}},a.createElement(_t.Z,{name:"sequence-start",onClick:()=>Ee.ask("set-timeline",0)}),a.createElement(_t.Z,{name:n?"pause":"play",onClick:()=>Ee.ask("change-timeline-state",n?V.Z.PAUSE:V.Z.START)}),a.createElement(_t.Z,{name:"sequence-end",onClick:()=>Ee.ask("set-timeline",e.duration)})),a.createElement("div",{style:{position:"absolute",right:i.Z.ms(0),top:i.Z.ms(0),display:"flex"}},a.createElement(st,{title:"Durate"},a.createElement(_t.Z,{name:"time"})),a.createElement(xn.Z,{position:"top",options:r,value:e.duration/1e3,placeholder:"durate",onChange:e=>Ee.ask("set-timeline-duration",1e3*e)}),a.createElement(st,{title:"FPS"},a.createElement(_t.Z,{name:"time"})),a.createElement(xn.Z,{position:"top",options:o,value:e.framerate,placeholder:"framerate",onChange:e=>Ee.ask("set-timeline-framerate",e)}),a.createElement("div",null,"Frames: ",Math.round(e.duration/1e3*e.framerate))),a.createElement(Rn,{enableMoveTime:t,sequence_framerate:e.framerate,sequence_duration:e.duration,current_time:s.current_time,onChange:e=>Ee.ask("set-timeline",e),renderedFrames:c,steps:12}))})));var Mn=n(46847);const Fn=["Line","Triangle","Rect","RegularPolygon","Circle","Rose","Spiral","Lissajous","Desidus","Shape","ShapeLoop","Group"];const Bn=o.ZP.div`
	height: ${i.Z.ms(2)};
	display: grid;
	grid-template-columns: repeat(7, max-content);
	justify-content: right;
	align-items: center;
	grid-gap: ${i.Z.ms(-1)};
	padding: 0 ${i.Z.ms(-1)};

	background: ${i.Z.color("dark")};
	border: 1px solid ${i.Z.color("dark-lighten")};
	border-top-width: 0;
`,Nn=o.ZP.div`
	height: ${i.Z.ms(2)};
	display: grid;
	grid-template-columns: repeat(4, max-content);
	justify-content: left;
	align-items: center;
	grid-gap: ${i.Z.ms(-1)};
	padding: 0 ${i.Z.ms(-1)};

	background: ${i.Z.color("dark")};
	border: 1px solid ${i.Z.color("dark-lighten")};
	border-top-width: 0;
`,Hn=o.ZP.div`
	position: relative;
	z-index: 10;
`,qn=o.ZP.ul`
	position: fixed;
	list-style: none;
	margin: 0;
	background: ${i.Z.color("dark")};
	border: 1px solid ${i.Z.color("dark").lighten(5)};
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.8);
	padding: 0;
	font-size: ${i.Z.sub(0,-4)};
	z-index: ${e=>e.open?1:-1};
	pointer-events: ${e=>e.open?null:"none"};
	transition: transform 0.1s, opacity 0.1s;
	transform-origin: bottom right;
	transform: translate(-92%, -99%) scale(${e=>e.open?1:.8});
	opacity: ${e=>e.open?1:0};
	display: grid;
	grid-template-columns: repeat(3, auto);
`,Un=o.ZP.li`
	cursor: pointer;
	padding: ${i.Z.ms(-1)} ${i.Z.ms(0)};
	display: block;
	&:hover {
		background: ${i.Z.color("dark").darken(10)};
	}
`,Vn=a.memo((e=>{const[t,n]=a.useState(null),[r,i]=a.useState(!1),o=a.useRef(null);a.useEffect((()=>{function e(e){e.target&&o.current&&e.target!=o.current&&!o.current.contains(e.target)&&i(!1)}return document.addEventListener("click",e,{passive:!0}),()=>{document.removeEventListener("click",e)}}),[r]);const s=0===e.selecteds.length,l=1===e.selecteds.length,c=e.selecteds.length>1,d=Object.values(e.layers),m=l&&(0,Mn.sE)(e.selecteds[0],d),u=e.selecteds.map((e=>(0,Mn.sE)(e,d))).filter((e=>!!e)),p=!(!l||!m)&&m.bPrimitive,h=(t&&(s||l&&t.layer.id!==m.id||t.type),c||s||!t||"copy-properties"!=t.type||m&&t.layer.id==m.id),f=s||l||!function(e){return 2==e.length&&e[0].parentId==e[1].parentId&&(e[0].bPrimitive&&"Line"!==e[0].type&&void 0===e[0].props.repetitions||1==e[0].props.repetitions)&&(e[1].bPrimitive&&"Line"!==e[1].type&&void 0===e[1].props.repetitions||1==e[1].props.repetitions)}(u),g=m?(0,Mn.tO)(m,d):-100,v=(0,Mn.o_)(e.selecteds,d);function y(n,a,r){switch(a){case"add":Ee.run("add",{type:r,parentId:l&&m?m.id:void 0}),i(!1);break;case"paste":t&&"copy-properties"!==t.type&&Ee.run(t.type,{id:t.layer.id,parentId:l&&m?m.id:void 0,props:t.layer.props});break;case"paste-properties":if(t&&"copy-properties"==t.type&&m){const e=t.layer.props,n=m.props;Ee.run("set-prop",function(e,t,n){const a=[];return Object.keys(t).forEach((r=>{a.push({id:e,name:r,value:t[r],prev_value:n[r]})})),a}(m.id,e,n))}break;case"union":case"difference":case"intersect":case"xor":2==e.selecteds.length&&Ee.run("shape-operation",{type:a,a_id:e.selecteds[0],b_id:e.selecteds[1]});break;default:Ee.run(a,r)}}return a.createElement(a.Fragment,null,a.createElement(Bn,null,a.createElement(st,{position:"top",title:"Copy properties",disabled:s||c},a.createElement(_t.Z,{name:"copy-properties",disabled:s||c,onClick:()=>function(e){if(!s&&!c){const t=m;n({type:e,layer:t}),je(`${e} ${t.name}`)}}("copy-properties")})),a.createElement(st,{position:"top",title:"Paste properties",disabled:h},a.createElement(_t.Z,{name:"paste-properties",disabled:h,onClick:e=>y(0,"paste-properties")})),a.createElement(st,{position:"top",title:"Add shape",disabled:r||!s||p},a.createElement(Hn,{ref:o},a.createElement(_t.Z,{onClick:()=>i(!r),style:{position:"relative",zIndex:2},name:"add",rotate:r?45:0,disabled:!s&&p}),a.createElement(qn,{open:r},Fn.map((e=>a.createElement(Un,{key:e,onClick:t=>{y(0,"add",e)}},e)))))),a.createElement(st,{position:"top",title:"Move down",disabled:c||g<=-2||-1==g},a.createElement(_t.Z,{name:"arrow-right-fill",size:0,rotate:90,disabled:c||g<=-2||-1==g,onClick:t=>y(0,t.shiftKey?"move-to-bottom":"move-down",e.selecteds)})),a.createElement(st,{position:"top",title:"Move up",disabled:c||g<=-2||1==g},a.createElement(_t.Z,{name:"arrow-right-fill",size:0,rotate:270,disabled:c||g<=-2||1==g,onClick:t=>y(0,t.shiftKey?"move-to-top":"move-up",e.selecteds)})),a.createElement(st,{position:"top",title:"Make shape",disabled:s||!v},a.createElement(_t.Z,{name:"shape",disabled:s||!v,onClick:t=>y(0,"make-shape",e.selecteds)})),a.createElement(st,{position:"top",title:"Remove",disabled:s},a.createElement(_t.Z,{name:"remove",disabled:s,onClick:t=>y(0,"remove",e.selecteds)}))),a.createElement(Nn,null,a.createElement(st,{position:"top",title:"Union",disabled:f},a.createElement(_t.Z,{name:"shape-combine-union",disabled:f,onClick:e=>y(0,"union")})),a.createElement(st,{position:"top",title:"Difference",disabled:f},a.createElement(_t.Z,{name:"shape-combine-difference",disabled:f,onClick:e=>y(0,"difference")})),a.createElement(st,{position:"top",title:"Intersect",disabled:f},a.createElement(_t.Z,{name:"shape-combine-intersect",disabled:f,onClick:e=>y(0,"intersect")})),a.createElement(st,{position:"top",title:"XOR",disabled:f},a.createElement(_t.Z,{name:"shape-combine-xor",disabled:f,onClick:e=>y(0,"xor")}))))})),Wn=({layer:e,deep:t,toggleSelection:n,layers:r,selecteds:o})=>{const[s,l]=a.useState(!(!r||1!=o.length)&&(0,Mn.$4)(e.id,o[0],r)),[c,d]=a.useState(!1),m=a.createRef(),u=o.includes(e.id);function h(){m.current&&m.current.value.length>0&&(m.current.value!=e.name&&Ee.ask("layer-rename",{id:e.id,name:m.current.value}),d(!1))}return a.useEffect((()=>{r&&!s&&(0,Mn.$4)(e.id,o[0],r)&&l(!0)}),[o,s,r]),a.createElement(Yn,{deep:t},a.createElement(Gn,{selected:u},c?a.createElement(Kn,{ref:m,autoFocus:!0,defaultValue:e.name,onKeyDown:e=>13==e.keyCode&&h(),onFocus:e=>e.target.select()}):a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement(Jn,{onClick:()=>e.children&&e.children.length>0&&l(!s)},e.children&&e.children.length>0&&a.createElement(_t.Z,{name:"arrow-right-fill",size:0,rotate:s?90:0,fill:"#fff"})),a.createElement(Xn,{onClick:t=>n(t,e.id)},a.createElement(_t.Z,{size:0,name:(0,p.q7)(e.type)}),a.createElement("span",{style:{marginLeft:i.Z.ms(-3)}},e.name))),c?a.createElement(_t.Z,{name:"save",fill:"#fff",onClick:()=>h()}):a.createElement(st,{title:"Rename"},a.createElement(_t.Z,{name:"edit",fill:"#fff",onClick:()=>d(!0)})),a.createElement(st,{title:"Highlight"},a.createElement(_t.Z,{name:"highlight",fill:"#fff",onMouseOver:()=>Ee.ask("layer-highlight",{id:e.id,status:!0}),onMouseOut:()=>Ee.ask("layer-highlight",{id:e.id,status:!1})})),a.createElement(st,{title:"Visibility"},e.data.visible?a.createElement(_t.Z,{name:"visible",fill:"#fff",onClick:()=>Ee.ask("layer-visibility",{id:e.id,status:!1})}):a.createElement(_t.Z,{name:"hidden",fill:"#fff",onClick:()=>Ee.ask("layer-visibility",{id:e.id,status:!0})}))),s&&e.children&&e.children.length>0&&a.createElement("ul",{style:{margin:0,padding:0}},e.children.map((e=>a.createElement(Wn,{key:e.id,layers:r,layer:e,selecteds:o,toggleSelection:n,deep:t+1})))))},Gn=o.ZP.div`
	border: 1px solid ${e=>e.selected?i.Z.color("primary"):i.Z.color("dark")};
	display: grid;
	align-items: center;
	grid-template-columns: auto max-content max-content max-content;
	line-height: ${i.Z.ms(2)};
	grid-gap: ${i.Z.ms(-2)};
	padding-right: ${i.Z.ms(-2)};

	&:hover {
		background: ${i.Z.color("dark").lighten(10)};
	}
`,Yn=o.ZP.li`
	list-style: none;
	margin: 0;
	user-select: none;

	position: relative;
	z-index: 1;

	> ${Gn} {
		padding-left: ${e=>e.deep>0?i.Z.mul(i.Z.add(0,-2,-2),e.deep+"rem"):0};
	}
`,Xn=o.ZP.div`
	display: flex;
	align-items: center;
	width: 100%;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
	cursor: cell;
`,Kn=o.ZP.input`
	width: 100%;
	line-height: inherit;
	background: ${i.Z.color("dark-lighten")};
	border: none;
	padding: 0 ${i.Z.ms(-1)};
`,Jn=o.ZP.div`
	cursor: pointer;
	width: ${i.Z.add(0,-3)};
	padding-left: ${i.Z.ms(-3)};
	height: 100%;
`,Qn=a.memo(Wn),ea={padding:`0 ${i.Z.ms(0)}`,height:i.Z.ms(2),lineHeight:i.Z.ms(2),fonstSize:i.Z.sub(0,-3),fontWeight:"bold",color:i.Z.color("gray-dark").toString("hex"),borderRadius:"2px 2px 0 0",background:i.Z.color("dark").toString("hex"),border:`1px solid ${i.Z.color("dark-lighten")}`,borderBottom:"0px"},ta={maxHeight:`calc(100vh - ${i.Z.add(2,1,2,2,2)})`,listStyle:"none",margin:0,padding:0,overflowY:"auto",overflowX:"hidden",border:`1px solid ${i.Z.color("dark-lighten")}`,borderWidth:"0 1px"},na=a.memo((0,r.$j)((e=>{var t;return{layers:e.project.scene,selecteds:e.project.selected_layers,open_layer_id:null===(t=e.project.open_layer_properties)||void 0===t?void 0:t.id}}),(e=>({selectLayers:(t,n=!1)=>e((0,ve.vl)(t,n))})))((({layers:e,open_layer_id:t,selectLayers:n,selecteds:r})=>{const o=Object.values(e);function s(e,t){const a=(0,Mn.c8)(e,t,r,o);console.log("new_selecteds",a),n(a)}return a.useEffect((()=>{function a(){const a=window.location.pathname;if(a.length>0&&"/"!=a){const r=a.substr(1);if(t!=r){(0,Mn.JU)(r,Object.values(e))&&n([r],!0)}}else n([],!0)}return window.addEventListener("popstate",a,{passive:!0}),()=>{window.removeEventListener("popstate",a)}}),[e,t]),a.createElement("section",{"data-name":"layers",style:{height:"100%"}},a.createElement("div",{style:ea},"Layers"),a.createElement("ul",{style:ta},o.length>0?o.map((e=>a.createElement(Qn,{key:e.id,layers:o,toggleSelection:s,selecteds:r,layer:e,deep:0}))):a.createElement("li",{style:{color:i.Z.color("gray-dark").toString("hex"),padding:`0 ${i.Z.ms(0)}`,lineHeight:i.Z.ms(2),borderTop:"1px solid rgba(0,0,0,0)"}},a.createElement("small",null,a.createElement("i",null,"Add new shape from Toolbar or ",a.createElement(_t.Z,{fill:i.Z.color("gray-dark").toString("hex"),name:"add"}))))),a.createElement(Vn,{selecteds:r,layers:e}))}))),aa=o.ZP.section`
	border: 1px solid ${i.Z.color("dark-lighten")};
	border-radius: 2px 2px 0 0;

	& + & {
		margin-top: ${i.Z.ms(0)};
	}
`,ra=o.ZP.header`
	cursor: ${e=>e.expandable?"pointer":null};
	display: grid;
	align-items: center;
	grid-template-columns: ${e=>e.withAction?"max-content auto max-content max-content":"max-content auto max-content"};
	grid-gap: ${i.Z.ms(-1)};
	padding: 0 ${i.Z.ms(0)};
	line-height: ${i.Z.ms(2)};
	height: ${i.Z.ms(2)};
	background: ${i.Z.color("dark")};
	fonst-size: ${i.Z.sub(0,-3)};
	font-weight: bold;
	color: ${i.Z.color("gray-dark")};
	white-space: nowrap;
	text-overflow: ellipsis;
	overflow: hidden;
`,ia=o.ZP.section`
	padding: ${i.Z.ms(0)};

	display: grid;
	grid-template-columns: 1fr;
	grid-gap: ${i.Z.ms(-2)};
	font-size: ${i.Z.sub(0,-4)};

	> * {
		line-height: ${i.Z.add(1,-1)};
	}
`,oa=a.memo((e=>{const[t,n]=a.useState(void 0===e.expanded||e.expanded);return a.createElement(aa,null,a.createElement(ra,{withAction:!!e.action,expandable:!!e.expandable,onClick:()=>e.expandable&&n(!t)},a.createElement(_t.Z,{name:e.icon,fill:i.Z.color("gray-dark").toString("hex")}),a.createElement("span",null,e.name),e.action&&e.action,e.expandable&&a.createElement(_t.Z,{name:"arrow-right",fill:i.Z.color("gray-dark").toString("hex"),cursor:"pointer",rotate:90,style:{transform:`scale(1, ${t?-1:1})`}})),t&&a.createElement(ia,null,e.children))})),sa=a.memo((e=>{const[t,n]=a.useState(),r=e.layer,o=r.name;function s(){const e=r.id;return(0,E.Oi)(Ee.ask("get-buffer-length",{id:e}).then((t=>{r.id===e&&n(t)})))}a.useEffect((()=>{let e,t=!1;return Ee.attach("scene:update-scene_child-prop",(n=>{if(!t)for(let t=0,a=n.length;t<a;t++)if(n[t].id===r.id&&("repetitions"===n[t].name||"shape"===n[t].name))return e=s()})),e=s(),()=>{t=!0,e&&e.cancel()}}),[r.id]);const l=(0,Mn.Dz)(r);return a.createElement(oa,{name:o,icon:(0,p.q7)(r.type),expandable:!0,expanded:!0,action:a.createElement(_t.Z,{name:"highlight",size:0,onMouseOver:()=>Ee.ask("layer-highlight",{id:r.id,status:!0}),onMouseOut:()=>Ee.ask("layer-highlight",{id:r.id,status:!1})})},"Number of points: ",t,l.length>0&&a.createElement("div",{style:{marginTop:i.Z.ms(0)}},"Primitives:",a.createElement("div",{style:{maxHeight:"10vh",overflowY:"auto",overflowX:"hidden"}},l.map((t=>a.createElement(Zt,{key:t.id,columns:4,gap:i.Z.ms(-2),valign:"center",flow:"auto max-content max-content max-content"},a.createElement("div",null,t.name),a.createElement(_t.Z,{name:"highlight",size:0,onMouseOver:()=>Ee.ask("layer-highlight",{id:t.id,status:!0}),onMouseOut:()=>Ee.ask("layer-highlight",{id:t.id,status:!1})}),a.createElement(st,{title:"Open"},a.createElement(_t.Z,{name:"to-top",size:0,onClick:()=>e.selectLayer&&e.selectLayer(t.id)}))))))))}));var la=n(60953);let ca=0;const da=a.memo((e=>{const t="rb_"+ ++ca+"_"+e.name;return a.createElement(Zt,{columns:e.values.length,flow:`auto repeat(${e.values.length}, auto)`,gap:i.Z.ms(0),valign:"center",halign:e.align||"space-around"},a.createElement("div",null,e.name),e.values.map((({key:n,value:r})=>a.createElement(ma,{key:t+"_"+n},a.createElement(ua,{id:t+"_"+n,name:t,value:r,defaultChecked:r==e.selected,onClick:t=>{e.onChange(t.target.value)}}),a.createElement("label",{htmlFor:t+"_"+n},n)))))})),ma=o.ZP.div`
    position: relative;
    line-height: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: pointer;
    padding-bottom: 3px;
    color: ${i.Z.color("gray-dark")};
    font-size: .8rem;
    
    input:checked+label {
        color: ${i.Z.color("primary")};
    }

    label { cursor: pointer; }
`,ua=o.ZP.input.attrs({type:"radio"})`
    position: absolute; 
    bottom: 0; left: 0;
    appearance: none;
    width: 100%;
    height: 3px;
    margin: 0;
    background: ${i.Z.color("gray-dark")};
    &:checked{
        background: ${i.Z.color("primary")};
    }
`;var pa=n(34943);let ha=null;const fa=function(e,t,n,r){a.useEffect((()=>{var a;function i(e){(0,p.sn)(e)&&(e.shiftKey?(e.stopImmediatePropagation(),ha&&(ha.type===t.type||"multiple-range"===ha.type&&"range"===t.type||"multiple-range"===t.type&&"range"===ha.type)&&(r(ha.value),je(ha.name+" pasted to "+t.name))):(e.stopImmediatePropagation(),ha={value:n,type:t.type,name:t.name},je(t.name+" copied")))}return null===(a=e.current)||void 0===a||a.addEventListener("click",i,{passive:!0}),()=>{var t;null===(t=e.current)||void 0===t||t.removeEventListener("click",i)}}),[e,n,t,r])};var ga=n(47790);const va=o.ZP.button`
    border: none;
    color: rgba(255,255,255,.8);
    background: none;
    cursor: pointer;
    line-height: 1;
    border-bottom: 2px solid ${i.Z.color("primary")};
    padding: ${i.Z.ms(-1)};

    &:hover {
        color: rgba(255,255,255,1);
    }
`,ya=a.memo((({label:e,onClick:t})=>a.createElement(va,{onClick:t},e)));var ba=n(53892),Ea=n(12739);const Za={sinusoidal:[{key:"sin",value:"sin"},{key:"cos",value:"cos"}],easing:Object.keys(ba.Z).map((e=>({key:e,value:e})))};function wa(e,t){return t}const xa=a.memo((({state:e,onChange:t,bColor:n,sequence:r})=>a.createElement(Zt,{gap:i.Z.ms(-2),valign:"center",style:{margin:`${i.Z.ms(0)} 0`},columns:2,rows:5,flow:`repeat(5, 1fr) / max-content ${i.Z.ms(4)}`},a.createElement("div",{style:{gridColumn:"1 / span 2"}},a.createElement(da,{name:"Type",align:"flex-start",values:[{key:"Loop",value:"loop"},{key:"Uncontrolled loop",value:"uncontroller-loop"},{key:"Static",value:"static"}],selected:e.type,onChange:e=>t("type",e)})),"loop"!==e.type&&a.createElement(a.Fragment,null,a.createElement("div",null,"Delay"),a.createElement(ga.Z,{size:2,min:0,max:r.duration,step:100,value:e.delay||0,onChange:(e,n)=>"none"===n&&t("delay",e)})),a.createElement("div",{style:{width:i.Z.ms(5),gridColumn:"1 / span 2"}},a.createElement(da,{name:"Mode",align:"flex-start",values:[{key:"Sinusoidal",value:"sinusoidal"},{key:"Easing",value:"easing"}],selected:e.mode,onChange:e=>t("mode",e)})),a.createElement("div",null,"Mode function"),a.createElement(xn.Z,{onChange:e=>t("modeFunction",e),placeholder:`${e.mode} function`,options:Za[e.mode||"cos"],value:e.modeFunction}),"loop"===e.type&&"easing"===e.mode&&a.createElement("small",{style:{gridColumn:"1 / span 2"}},"the durate of animation will be",a.createElement("br",null),"divide for two."),a.createElement(Zt,{columns:n?2:1},a.createElement("div",null,a.createElement(Dt.Z,{checked:e.invertOdd,name:"Invert odd",onChange:e=>t("invertOdd",e)})),n&&a.createElement("div",null,a.createElement(da,{name:"Color mode",values:[{key:"rgb",value:"rgb"},{key:"hue",value:"hue"}],selected:e.colorTransitionMode,onChange:e=>t("colorTransitionMode",e)})))))),ka=a.memo((e=>{function t(t,n,a){let r;void 0!==a?(r=(0,p.qo)(e.value),r[a]=t):r=t,e.onChange(r,n)}if(e.locked)return a.createElement(ga.Z,Object.assign({},e,{value:(0,p.He)(e.value),onChange:(e,n)=>t(e,n)}));const n=(0,p.qo)(e.value);return a.createElement(Zt,{rows:2,gap:i.Z.ms(-4),style:{height:"100%",width:"100%"}},a.createElement(ga.Z,Object.assign({},e,{small:!0,value:n[0],onChange:(e,n)=>t(e,n,0)})),a.createElement(ga.Z,Object.assign({},e,{small:!0,value:n[1],onChange:(e,n)=>t(e,n,1)})))})),_a=a.memo((({value:e,name:t,onChange:n,sceneChildProp:r})=>{switch(r.type){case"color":return a.createElement(vn,{size:i.Z.add(1,-1),value:e,onChange:(e,a)=>!1===a&&n(t,e)});case"range":return a.createElement(ga.Z,{value:Ea.Z.bValueTransformable(e)?e.value:e,onChange:(e,a)=>"none"===a&&n(t,e),min:r.min,max:r.max,step:r.step});case"multiple-range":{const[o,s]=a.useState(!Array.isArray(e)||e[0]===e[1]);return a.createElement("div",{style:{display:"flex",gap:i.Z.ms(-2),alignItems:"center",height:"100%"}},a.createElement(_t.Z,{size:0,style:{marginRight:i.Z.ms(-2)},name:o?"unlock-value":"lock-value",onClick:()=>s(!o)}),a.createElement(ka,{locked:o,value:Ea.Z.bValueTransformable(e)?e.value:e,onChange:(e,a)=>"none"===a&&n(t,e),min:r.min,max:r.max,step:r.step}))}case"slider":return a.createElement(en,{value:e,onChange:(e,a)=>"none"===a&&n(t,e),min:r.min,max:r.max,step:r.step})}return null})),Ca=a.memo((0,r.$j)((e=>({sequence:e.project.sequence})))((({close:e,value:t,onChange:n,sequence:r,layer:o,prop_name:s})=>{const l=L.Z[s],c=Ea.Z.bValueAnimation(t),d=function(e,t,n=1e3){const a=Ea.Z.bValueAnimation(e)&&"simple"==e.type?e.value:{};return Object.assign({from:Array.isArray(t.default)?(0,p.He)(t.default):t.default,to:t.default_animate,duration:n,invertOdd:!1,colorTransitionMode:"rgb",type:"loop",mode:"sinusoidal",modeFunction:"sin",type_value:t.type_value,delay:0},a)}(t,l,Math.min(2e3,r.duration)),[m,u]=a.useState(d),[h,f]=a.useState(c&&("loop"!==(g=d).type||"sinusoidal"!==g.mode||"sin"!==g.modeFunction||!1!==g.invertOdd||"rgb"!==g.colorTransitionMode));var g;function v(e,t){if("mode"===e){const e=Za[t];u(Object.assign(Object.assign({},m),{mode:t,modeFunction:e[0].value}))}else u("type"===e?Object.assign(Object.assign({},m),{type:t,mode:"static"===t?"easing":m.mode,modeFunction:"static"===t&&"easing"!=m.mode?Za.easing[0].value:m.modeFunction}):Object.assign(Object.assign({},m),{[e]:t}))}return a.createElement("div",null,a.createElement("h2",null,"Simple animation"),a.createElement("small",null,"Animate prop ",a.createElement("b",null,s)," of shape ",o.name),a.createElement(Zt,{gap:i.Z.ms(-2),valign:"center",style:{margin:`${i.Z.ms(0)} 0`},flow:`repeat(3, 1fr) / max-content ${i.Z.ms(4)}`},a.createElement("div",null,"From"),a.createElement(_a,{value:m.from,onChange:v,name:"from",sceneChildProp:l}),a.createElement("div",null,"To"),a.createElement(_a,{value:m.to,onChange:v,name:"to",sceneChildProp:l}),a.createElement("div",null,"Durate"),a.createElement(ga.Z,{size:i.Z.add(1,-1),min:0,max:r.duration,step:100,value:m.duration,onChange:(e,t)=>"none"==t&&v("duration",e)})),a.createElement(Dt.Z,{checked:h,onChange:e=>f(e),name:"Advance mode",size:0}),h&&a.createElement(xa,{state:m,bColor:"color"===l.type,sequence:r,onChange:v}),a.createElement("div",null,a.createElement("div",{style:{margin:`${i.Z.ms(0)} 0`,textDecoration:"underline",cursor:"pointer"},onClick:function(){e(),(0,Ye.$7)(o.id,s)}},"Open visual editor in new window"),a.createElement("div",{style:{margin:`${i.Z.ms(0)} 0`,textDecoration:"underline",cursor:"pointer"},onClick:function(){e(),(0,Ye.lI)(o.id,s)}},"openCodeEditor")),a.createElement(ya,{onClick:function(){n({type:"simple",value:wa(0,m)})},label:"Apply"}),c&&a.createElement(ya,{onClick:function(){n(void 0)},label:"Remove"}))}))),Sa=o.ZP.div`
	position: fixed;
	top: 0;
	left: 0;
	width: 100vw;
	height: 100vh;
	z-index: 10000;
	display: flex;
	justify-content: center;
	align-items: center;
`,$a=o.F4`
    from { opacity: 0; }
    to { opacity: 1; }
`,ja=o.ZP.div`
	position: fixed;
	top: 0;
	left: 0;
	width: 100vw;
	height: 100vh;
	animation: ${$a} 0.1s ease-out both;
	background: rgba(0, 0, 0, 0.6);
`,Oa=o.F4`
    from { opacity: 0; transform: scale(.98); }
    to { opacity: 1; transform: scale(1); }
`,Pa=o.ZP.div`
	position: relative;
	z-index: 1000;
	max-width: 80vw;
	background: ${i.Z.color("dark-lighten")};
	padding: ${i.Z.ms(2)};
	box-shadow: 0 ${i.Z.ms(0)} ${i.Z.ms(2)} ${i.Z.ms(0)} rgba(0, 0, 0, 0.5);
	animation: ${Oa} 0.1s ease-out both;
	border-radius: 2px;
`,Da=o.ZP.div`
	position: absolute;
	top: ${i.Z.ms(-1)};
	right: ${i.Z.ms(-1)};
`,za=a.memo((({bCloseOnBackground:e,open:t,close:n,children:r,noCloseButton:i=!1})=>{const o=document.getElementById("modal-root"),s=document.createElement("div");return a.useEffect((()=>(o.appendChild(s),()=>{o.removeChild(s)})),[o,s]),t?Ae.createPortal(a.createElement(Sa,null,a.createElement(ja,{onClick:t=>e&&n&&n(t)}),a.createElement(Pa,null,!i&&a.createElement(Da,null,a.createElement(_t.Z,{onClick:n,name:"close"})),r)),s):null})),Aa=o.ZP.div`
	position: absolute;
	bottom: 0;
	left: 0;
	background: ${i.Z.color("dark")};
	border-radius: 0 2px 0 0;
	line-height: 1;
	z-index: 1;
	transform: scale(0);
	transform-origin: left bottom;
	transition: transform 0.1s 0.5s ease-out;
`,Ra=o.ZP.div`
	position: relative;

	&:hover ${Aa} {
		transform: scale(1);
	}
`,Ta=a.memo((({name:e,value:t,layer:n,prop_name:r,bDefaultValue:o,onChange:s})=>{const[l,c]=a.useState(!1),d=Ea.Z.bValueAnimation(t);return a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column"}},a.createElement("div",{style:{lineHeight:1,marginBottom:i.Z.ms(-2)}},e),a.createElement("div",{style:{display:"flex"}},a.createElement(Ra,null,a.createElement(Aa,{style:{},onClick:()=>s(void 0)},a.createElement(_t.Z,{size:0,name:"close"})),d?a.createElement(_t.Z,{size:i.Z.add(1,-1),name:"animate-color"}):a.createElement(vn,{onChange:s,value:t,size:i.Z.add(1,-1)})),a.createElement(st,{title:"Animate prop",position:"right"},a.createElement(_t.Z,{name:d?"animated":"not-animated",onClick:()=>c(!0)}))),a.createElement(za,{open:l,close:()=>c(!1)},a.createElement(Ca,{close:()=>c(!1),value:t,layer:n,prop_name:r,onChange:e=>(s(e,"slider"=="none"),void(l&&c(!1)))})))})),La=a.memo((({name:e,prop_name:t,value:n,min:r,max:o,step:s,type:l,animable:c,layer:d,initialArray:m,onChange:u,bDefaultValue:p})=>{const[h,f]=a.useState(!1),[g,v]=a.useState(!m&&Array.isArray(n)&&n[0]===n[1]),y=Ea.Z.bValueAnimation(n),b="multiple-range"==l,E=b?ka:ga.Z;function Z(e,t){u(e,"slider"==t),h&&f(!1)}return a.createElement(Zt,{columns:3,flow:"1fr 1fr max-content",gap:i.Z.ms(0),style:{userSelect:"none"}},a.createElement("div",{onClick:()=>!y&&b&&void v(!g),style:{textAlign:"right",cursor:b?"pointer":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},!y&&b&&a.createElement(_t.Z,{size:0,style:{marginRight:i.Z.ms(-2)},name:g?"unlock-value":"lock-value",onClick:()=>null}),e),y?a.createElement("div",{style:{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}},"simple"==n.type?a.createElement("small",null,a.createElement("i",null,Ea.Z.bValueTransformable(n.value.from)?n.value.from.value:n.value.from," ","→",Ea.Z.bValueTransformable(n.value.to)?n.value.to.value:n.value.to," in"," ",Math.round(n.value.duration/100)/10,"s")):a.createElement("span",null,a.createElement("i",null,"raw function"))):a.createElement(E,{bDefaultValue:p,locked:g,value:n,min:r,max:o,step:s,onChange:Z}),a.createElement("div",{style:{width:i.Z.ms(1)}},c&&a.createElement(st,{title:"Animate prop",position:"left"},a.createElement(_t.Z,{name:y?"animated":"not-animated",onClick:()=>f(!0)}))),a.createElement(za,{open:h,close:()=>f(!1)},a.createElement(Ca,{close:()=>f(!1),value:n,layer:d,prop_name:t,onChange:e=>Z(e,"none")})))})),Ia=a.memo((({name:e,value:t,layer:n,min:r,max:o,step:s,prop_name:l,bDefaultValue:c,onChange:d})=>{const[m,u]=a.useState(!1),p=Ea.Z.bValueAnimation(t);return a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"}},a.createElement("div",{style:{lineHeight:1,marginBottom:i.Z.ms(-2)}},e),a.createElement("div",{style:{display:"flex",height:i.Z.add(1,-1),alignItems:"center",justifyContent:"center",width:"100%"}},p?a.createElement(_t.Z,{size:i.Z.add(1,-1),name:"animate-color"}):a.createElement(en,{min:r,max:o,step:s,onChange:d,value:t}),a.createElement(st,{title:"Animate prop",position:"right"},a.createElement(_t.Z,{name:p?"animated":"not-animated",onClick:()=>u(!0)}))),a.createElement(za,{open:m,close:()=>u(!1)},a.createElement(Ca,{close:()=>u(!1),value:t,layer:n,prop_name:l,onChange:e=>(d(e,"none"),void(m&&u(!1)))})))}));var Ma=n(71932);const Fa=a.memo((0,r.$j)(((e,t)=>{let n=t.value;switch(Ma.Z[t.name].dataType){case"props":n=(0,pa.getProperty)(t.layer.props,t.name);break;case"drawer":n=(0,pa.getProperty)(t.layer.style,t.name);break;case"settings":n=(0,pa.getProperty)(t.layer,t.name)}return{value:n}}))((({name:e,layer:t,value:n,onChange:r,forceArray:i})=>{Ea.Z.bValueTransformable(n)&&(n=n.value);const o=a.useRef(null),s=L.Z[e];let l=null!=n?n:s.default;const c=void 0===n||(d=n,m=s.default,typeof d==typeof m&&(Array.isArray(d)&&Array.isArray(m)?d[0]===m[0]&&d[1]===m[1]:d===m));var d,m;let u=s.canBArray?Array.isArray(l)?"multiple-range":"range":s.type;function h(n,a){n!==l&&(Ea.Z.bPropInSceneChildUtilitiesData(e)?Ea.Z.bValueTransformable(n)||(Ea.Z.bValueAnimation(n)?(Ea.Z.bValueTransformable(n.value.from)||(n.value.from={type:"transformable-prop",value:n.value.from}),Ea.Z.bValueTransformable(n.value.to)||(n.value.to={type:"transformable-prop",value:n.value.to})):n={type:"transformable-prop",value:n=i?(0,p.qo)(n):n}):n=i?(0,p.qo)(n):n,Ee.run("set-prop",{id:t.id,name:e,value:n,prev_value:l},a),r&&r(n,l))}"Line"===t.type&&"sideLength"==e&&Array.isArray(l)&&(l=(0,p.He)(l),u="range"),fa(o,s,l,h);let f=null;switch(u){case"multiple-range":case"range":f=a.createElement(La,{value:(g=l,Array.isArray(g)?g.slice():g),bDefaultValue:c,canBArray:s.canBArray||!1,initialArray:s.initialArray||!1,min:s.min,max:"repetitions"==e?"multiple-range"==u?20:100:s.max,step:s.step,type:u,name:s.label,prop_name:s.name,layer:t,onChange:h,animable:s.animable});break;case"radio":f=a.createElement(da,{onChange:h,name:s.label,selected:l,values:s.options});break;case"checkbox":f=a.createElement(Dt.Z,{checked:l,onChange:h,name:s.label});break;case"select":f=a.createElement(xn.Z,{options:s.options,value:l,placeholder:s.label,onChange:h});break;case"color":f=a.createElement(Ta,{layer:t,prop_name:e,value:l,name:s.label,onChange:h,bDefaultValue:void 0===n});break;case"slider":f=a.createElement(Ia,{layer:t,name:s.label,prop_name:e,value:l,min:s.min,max:s.max,step:s.step,onChange:(e,t)=>h(e,"slider"==t),bDefaultValue:void 0===n})}var g;return a.createElement("div",{ref:o},f)})));var Ba=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Na=[{key:"Matrix",value:la.i.Matrix},{key:"Ring",value:la.i.Ring}],Ha=Ma.Z.repetitions.max,qa=Ma.Z.distance.max;function Ua(e){return Array.isArray(e.props.repetitions)?la.i.Matrix:la.i.Ring}const Va=a.memo((0,r.$j)((e=>({projectRatio:e.project.ratio})))((e=>{const t=e.layer;let n=t.props.repetitions||1,r=t.props.distance||0;const[i,o]=a.useState(Ua(t));return a.useEffect((()=>{const e=Ua(t);e!=i&&o(e)}),[t]),a.createElement(oa,{name:"Repetition",icon:"repetitions",expandable:!0,expanded:!0},!Ea.Z.bValueAnimation(n)&&a.createElement(da,{selected:i,values:Na,name:"Type",onChange:function(e){if(e!==i){const a=e==la.i.Matrix?(0,p.x)(1,Math.round(Ha/5),(0,p.qo)(n)):(0,E.uZ)(1,Ha,(0,p.He)(n)),i=[{id:t.id,name:"repetitions",value:a,prev_value:n}];if(!Ea.Z.bValueAnimation(r)){const n=Ea.Z.bValueTransformable(r)?r.value:r,a=e==la.i.Matrix?(0,p.x)(-qa,qa,(0,p.qo)(n)):(0,E.uZ)(-qa,qa,(0,p.He)(n));i.push({id:t.id,name:"distance",value:{type:"transformable-prop",value:a},prev_value:r})}Ee.run("set-prop",i),o(e)}}}),a.createElement(Fa,{layer:t,name:"repetitions",onChange:e=>n=e,forceArray:i==la.i.Matrix}),a.createElement(Fa,{layer:t,name:"distance",onChange:e=>r=e}),i==la.i.Ring&&a.createElement(Fa,{layer:t,name:"displace"}),!Ea.Z.bValueAnimation(n)&&a.createElement("small",{style:{textAlign:"right",cursor:"pointer"},onClick:()=>function(){return Ba(this,void 0,void 0,(function*(){if(i==la.i.Matrix){const e=(0,p.qo)(n),a=[e[1]<=1?0:100/e[1],e[0]<=1?0:100/e[0]];Ee.run("set-prop",{id:t.id,name:"distance",value:{type:"transformable-prop",value:a},prev_value:r})}else{const e=(0,p.He)(n);if(1==e)Ee.run("set-prop",{id:t.id,name:"distance",value:0,prev_value:r});else{const n=yield Ee.ask("single-bounding",{id:t.id}),a=e<=1?0:50*n.width/(Math.PI/(e+1));Ee.run("set-prop",{id:t.id,name:"distance",value:{type:"transformable-prop",value:(0,E.uZ)(-100,100,a)},prev_value:r})}}}))}()},"Distribute"),t.depth>0&&a.createElement("div",{style:{textAlign:"right",cursor:"pointer"}},a.createElement("div",{style:{display:"inline-block"}},a.createElement(Fa,{layer:t,name:"bUseParent"}))))}))),Wa=a.memo((({layer:e})=>a.createElement(oa,{name:"Primitive settings",icon:"primitive",expandable:!0,expanded:!0},a.createElement(Fa,{layer:e,name:"sideLength"}),e.shape&&a.createElement("div",{style:{textAlign:"right"}},a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle",cursor:"pointer"}},a.createElement(st,{title:"Subdivide buffer",position:"left"},a.createElement("div",{onClick:function(){Ee.run("subdivide",{id:e.id})}},"Subdivide")))),"Polygon"===e.type&&a.createElement(Fa,{layer:e,name:"sideNumber"}),"Rose"===e.type&&a.createElement(a.Fragment,null,a.createElement(Fa,{layer:e,name:"n"}),a.createElement(Fa,{layer:e,name:"d"})),"Lissajous"===e.type&&a.createElement(a.Fragment,null,a.createElement(Fa,{layer:e,name:"wx"}),a.createElement(Fa,{layer:e,name:"wy"}),a.createElement(Fa,{layer:e,name:"wz"})),"Spiral"===e.type&&a.createElement(a.Fragment,null,a.createElement(Fa,{layer:e,name:"twists"}),a.createElement(Fa,{layer:e,name:"twistsStart"}),a.createElement("div",{style:{display:"flex",gap:i.Z.ms(0)}},a.createElement("span",null,"Spiral type"),a.createElement("div",{style:{flex:1}},a.createElement(Fa,{layer:e,name:"spiral"})))),"SuperShape"===e.type&&a.createElement(a.Fragment,null,a.createElement(Fa,{layer:e,name:"a"}),a.createElement(Fa,{layer:e,name:"b"}),a.createElement(Fa,{layer:e,name:"m"}),a.createElement(Fa,{layer:e,name:"n1"}),a.createElement(Fa,{layer:e,name:"n2"}),a.createElement(Fa,{layer:e,name:"n3"})),a.createElement("div",{style:{textAlign:"right"}},a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle"}},a.createElement(Fa,{layer:e,name:"bClosed"}))),a.createElement(Fa,{layer:e,name:"adaptMode"})))),Ga=a.memo((e=>{const t=e.layer;return a.createElement(oa,{name:"Transformations",icon:"transform",expandable:!0,expanded:!0},a.createElement(Fa,{layer:t,name:"scale"}),a.createElement(Fa,{layer:t,name:"translate"}),a.createElement(Fa,{layer:t,name:"squeezeX"}),a.createElement(Fa,{layer:t,name:"squeezeY"}),a.createElement(Fa,{layer:t,name:"skewX"}),a.createElement(Fa,{layer:t,name:"skewY"}),a.createElement(Fa,{layer:t,name:"rotateX"}),a.createElement(Fa,{layer:t,name:"rotateY"}),a.createElement(Fa,{layer:t,name:"rotateZ"}),a.createElement(Fa,{layer:t,name:"transformOrigin"}),a.createElement(Fa,{layer:t,name:"perspective"}),a.createElement(Fa,{layer:t,name:"perspectiveOrigin"}),a.createElement("div",{style:{textAlign:"right"}},a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle",cursor:"pointer"}},a.createElement("div",{onClick:function(){(0,Ye.o2)(t.id+"")}},a.createElement(_t.Z,{name:"visual-editor"}),a.createElement("span",{style:{display:"inline-block",verticalAlign:"middle",marginLeft:i.Z.ms(-2)}},"Apply point transformation")))))})),Ya=a.memo((e=>{const t=e.layer;return a.createElement(oa,{name:"Loop generation",icon:"loop",expandable:!0,expanded:!0},a.createElement("div",{style:{textAlign:"center"}},a.createElement("div",{style:{display:"inline-block",verticalAlign:"middle",cursor:"pointer"}},a.createElement("div",{onClick:function(){(0,Ye.Z8)(t.id)}},a.createElement(_t.Z,{name:"visual-editor"}),a.createElement("span",{style:{display:"inline-block",verticalAlign:"middle",marginLeft:i.Z.ms(-2)}},"Generate Shape")))))}));var Xa=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Ka=a.memo((0,r.$j)((e=>({bGhost:e.project.ghosts>0})))((({layer:e,bGhost:t})=>{const[n,r]=a.useState(!!e.data.disableGhost);return a.useEffect((()=>{e.data.disableGhost!==n&&r(!!e.data.disableGhost)}),[e.id]),a.createElement(oa,{name:"Style",icon:"style",expandable:!0,expanded:!0},a.createElement(Zt,{columns:4,gap:i.Z.ms(-2),flow:"max-content max-content auto max-content",valign:"center",style:{width:"100%",overflow:"hidden"}},a.createElement(Fa,{layer:e,name:"fill"}),a.createElement(Fa,{layer:e,name:"stroke"}),a.createElement(Fa,{layer:e,name:"lineWidth"}),a.createElement("div",{style:{display:"flex",justifyContent:"center",flexDirection:"column"}},t&&a.createElement(a.Fragment,null,a.createElement("small",{style:{lineHeight:1,marginBottom:i.Z.ms(-2)}},"Disable Ghost"),a.createElement("div",{style:{display:"flex",height:i.Z.add(1,-1),alignItems:"center",justifyContent:"center"}},a.createElement(Dt.Z,{checked:n,name:"",onChange:function(){return Xa(this,void 0,void 0,(function*(){const t=!n;yield Ee.ask("layer-ghost",{id:e.id,status:t}),r(t)}))},size:1}))))))}))),Ja=(0,r.$j)((e=>({selected_layer:e.project.open_layer_properties})),(e=>({selectLayer:t=>e((0,ve.vl)([t]))})))((({selected_layer:e,selectLayer:t})=>a.createElement("section",{"data-name":"properties",style:{maxHeight:"100%",overflow:"auto"}},e?a.createElement(a.Fragment,null,a.createElement(sa,{layer:e,selectLayer:t}),"ShapeLoop"===e.type&&a.createElement(Ya,{layer:e}),(e.bPrimitive||"Group"===e.type)&&a.createElement(Ka,{layer:e}),a.createElement(Va,{layer:e}),e.bPrimitive&&a.createElement(Wa,{layer:e}),a.createElement(Ga,{layer:e})):a.createElement("i",null,"Select layer to change properties")))),Qa={style:{width:"100vw",height:"100%",overflow:"hidden",padding:`0 ${i.Z.ms(0)}`},columns:2,flow:"repeat(2, minmax(0, 1fr))",component:"section",gap:i.Z.ms(0)},er={columns:2,rows:2,valign:"start",flow:"auto max-content / max-content auto",gap:i.Z.ms(0),style:{height:`calc(100vh - ${i.Z.add(2,1)})`}},tr={columns:2,valign:"start",flow:"repeat(2, minmax(0, 1fr))",gap:i.Z.ms(0),style:{height:"100%",overflow:"hidden"}},nr=()=>a.createElement(Zt,Object.assign({},Qa,{id:"workspace"}),a.createElement(Zt,Object.assign({},er),a.createElement(bt,null),a.createElement(Cn,null),a.createElement("div",{style:{gridColumn:"1 / span 2"}},a.createElement(In,null))),a.createElement(Zt,Object.assign({},tr),a.createElement(na,null),a.createElement(Ja,null))),ar=['{"id":"eb94f280-5dd0-11eb-a957-dbb3bcd0c558","urpflanze_version":"%VERSION%","name":"EmptyProject","width":922,"height":498.37837837837833,"resolution":600,"background":"#111413","color":"#5c6361","clear":true,"ghosts":10,"ghostSkipTime":15,"ratio":1.85,"scene":{"7bd501c0-5a9b-11eb-a564-c1b5010acd62":{"id":"7bd501c0-5a9b-11eb-a564-c1b5010acd62","type":"Shape","name":"Shape_1","order":0,"data":{"visible":true},"depth":0,"bPrimitive":false,"props":{"distance":{"type":"simple","value":{"from":{"type":"transformable-prop","value":-10},"to":{"type":"transformable-prop","value":15},"duration":3000,"invertOdd":false,"colorTransitionMode":"rgb","type":"loop","mode":"sinusoidal","modeFunction":"cos","delay":0}},"repetitions":6,"rotateX":{"type":"transformable-prop"},"rotateY":0,"rotateZ":0,"squeezeY":0,"displace":{"type":"simple","value":{"from":{"type":"transformable-prop","value":0},"to":{"type":"transformable-prop","value":360},"duration":6000,"invertOdd":false,"colorTransitionMode":"rgb","type":"static","mode":"easing","modeFunction":"linear","delay":0}},"translate":{"type":"transformable-prop","value":[0,22.7]},"scale":1,"transformOrigin":[0,0],"perspective":0,"perspectiveOrigin":[0,0]},"style":{},"bUseParent":false,"bUseRecursion":false,"children":[{"id":"72080110-5a9b-11eb-a564-c1b5010acd62","type":"Circle","name":"Circle_1","data":{"visible":true},"depth":1,"bPrimitive":true,"props":{"distance":{"type":"simple","value":{"from":{"type":"transformable-prop","value":0},"to":{"type":"transformable-prop","value":15},"duration":2000,"invertOdd":false,"colorTransitionMode":"rgb","type":"loop","mode":"sinusoidal","modeFunction":"sin","delay":0}},"repetitions":39,"scale":0.56,"sideLength":{"type":"transformable-prop","value":1}},"style":{"fill":{"type":"simple","value":{"from":"hsla(37, 100%, 56%, 0.41)","to":"hsla(207, 100%, 50%, 0.26)","duration":2000,"invertOdd":false,"colorTransitionMode":"hue","type":"loop","mode":"sinusoidal","modeFunction":"sin","delay":0}}},"parentId":"7bd501c0-5a9b-11eb-a564-c1b5010acd62","bUseParent":false,"bUseRecursion":false,"adaptMode":0,"bClosed":true}]}},"sequence":{"duration":6000,"framerate":60}}'],rr=[],ir=o.F4`from { opacity: 1; } to { opacity: 0; } `,or=o.ZP.div`
	position: relative;
	width: 500px;
	height: 270px;
	overflow: hidden;
	position: relative;

	&:after {
		position: absolute;
		top: 0;
		left: 0;
		display: block;
		content: ' ';
		width: 100%;
		height: 100%;
		background: ${i.Z.color("dark")};
		animation: ${ir} 0.5s 0.1s linear both;
	}

	canvas {
		width: 100% !important;
		height: auto !important;
	}
`,sr=a.memo((()=>{const e=a.createRef();return a.useEffect((()=>{let t;if(e.current)if(Math.random()>1){const t=new Image;t.addEventListener("load",(()=>{var n;e.current&&(null===(n=e.current.getContext("2d"))||void 0===n||n.drawImage(t,0,0))})),e.current.width=1024,e.current.height=1024,e.current.style.transform="translateY(-25%)",t.src="/assets/images/examples/"+(0,$.randomElement)(rr)}else t=W.Z.parse((0,$.randomElement)(ar)),t&&(t.setBuffering(!0),t.setCanvas(e.current),null==t||t.startAnimation());return()=>{t&&t.stopAnimation()}}),[e.current]),a.createElement("div",{style:{position:"relative"}},a.createElement(or,null,a.createElement("canvas",{ref:e})),a.createElement("div",{style:{background:"linear-gradient(0deg, rgba(0,0,0, 0.4) 0%, rgba(0,0,0,0) 80%)",position:"absolute",bottom:-1,left:0,width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:`${i.Z.ms(-1)} ${i.Z.ms(0)}`,color:"rgba(255,255,255,.4)"}},a.createElement("div",null,"Author"),a.createElement("div",null,"Send yours")))})),lr=o.ZP.div`
	position: fixed;
	top: 50%;
	left: 50%;
	background: ${i.Z.color("dark-lighten")};
	transform: translate(-50%, -50%);
	box-shadow: 0 ${i.Z.ms(0)} ${i.Z.ms(2)} ${i.Z.ms(0)} rgba(0, 0, 0, 0.5);
	border-radius: 2px;
	z-index: 12;
`,cr=a.memo((0,r.$j)(null,(e=>({hide:()=>e((0,ye.hf)()),showTutorial:()=>e((0,ye.Sg)())})))((({hide:e,showTutorial:t})=>{const n=Ee.hasAutosave();return a.createElement(a.Fragment,null,a.createElement("div",{style:{position:"fixed",zIndex:11,top:0,left:0,width:"100vw",height:"100vh"},onClick:e}),a.createElement(lr,null,a.createElement(sr,null),a.createElement("div",{style:{padding:i.Z.ms(2)}},a.createElement("h2",{style:{marginBottom:i.Z.ms(0)}},"Work in progress"," ",a.createElement("small",{style:{fontSize:".8rem",fontWeight:"initial"}},"v",Oe.Z.app_version)),a.createElement(Zt,{rows:2,flow:"max-content max-content",gap:i.Z.ms(0)},a.createElement(Zt,{columns:2},a.createElement("div",{onClick:function(){e(),t()}},"Tutorial 👋"),a.createElement("div",null)),a.createElement(Zt,{columns:2},a.createElement("div",null,a.createElement("div",{style:{cursor:"pointer"},onClick:()=>{Fe((()=>e()))}},"New"),a.createElement("div",{style:{cursor:"pointer"},onClick:()=>{Be(!1,(()=>e()))}},"Open"),a.createElement("div",{style:{opacity:n?1:.2,cursor:n?"pointer":""},onClick:()=>{Ee.hasAutosave()&&(Ee.restoreAutosave(),e())}},"Recover Last Session")),a.createElement("div",null))))))}))),dr={position:"fixed",zIndex:11,top:0,left:0,width:"100vw",height:"100vh"},mr={position:"fixed",top:"50%",left:"50%",background:i.Z.color("dark-lighten").toString("hex"),transform:"translate(-50%, -50%)",boxShadow:`0 ${i.Z.ms(0)} ${i.Z.ms(2)} ${i.Z.ms(0)} rgba(0, 0, 0, 0.5)`,borderRadius:"2px",zIndex:12,padding:i.Z.ms(2)},ur=a.memo((0,r.$j)(null,(e=>({hide:()=>e((0,ye.vZ)())})))((({hide:e})=>a.createElement("div",{style:dr},a.createElement("div",{style:mr},a.createElement("div",{style:{overflow:"hidden",width:"100%",maxWidth:"36vw"}},a.createElement("h2",null,"Sorry!"),a.createElement("p",null,"Will be available soon")),a.createElement("div",{style:{marginTop:i.Z.ms(0),textAlign:"right"},onClick:e},a.createElement(ya,{label:"Close"}))))))),pr=a.memo((({render:e,ratio:t,settings:n})=>{const r=a.createRef(),[o,s]=a.useState("image"),[l,c]=a.useState(1);return a.useEffect((()=>{if(e&&r.current){const a=r.current,i=a.getContext("2d",{alpha:!0});let s=t>=1?n.size:n.size*t,c=t>=1?n.size/t:n.size;if(s>n.size){const e=s/c;s=n.size,c=n.size/e}else if(c>n.size){const e=c/s;c=n.size,s=n.size/e}if(a.width=s,a.height=c,i.clearRect(0,0,a.width,a.height),"pattern"==o&&l>1){a.width*=l,a.height*=l;const t=i.createPattern(e,"repeat");i.fillStyle=t,i.fillRect(0,0,a.width,a.height)}else i.drawImage(e,0,0,a.width,a.height)}}),[e,l]),a.createElement("div",{style:{position:"relative"}},a.createElement("div",{style:{display:"flex",justifyContent:"space-between",padding:`0 ${i.Z.ms(0)} ${i.Z.ms(0)} ${i.Z.ms(0)}`}},a.createElement(da,{name:"Preview type",selected:o,values:[{key:"Image",value:"image"},{key:"Pattern",value:"pattern"}],onChange:e=>s(e)}),a.createElement("div",null,"pattern"==o&&a.createElement("div",{style:{display:"flex",alignItems:"center"}},a.createElement("small",null,"Tiles"),a.createElement("div",null,a.createElement(_t.Z,{size:0,rotate:180,name:"arrow-right",disabled:l<=1,onClick:e=>l>1&&c(l-1)}),a.createElement("small",null,l),a.createElement(_t.Z,{size:0,name:"arrow-right",disabled:l>=5,onClick:e=>l<5&&c(l+1)}))))),a.createElement("div",{style:{width:"100%",height:"100%",lineHeight:0,fontSize:0,backgroundImage:"url(assets/images/png-background.png)",display:"flex",alignItems:"center",justifyContent:"center"}},a.createElement("canvas",{ref:r,style:{maxWidth:"100%",maxHeight:"100%"}})))})),hr=[256,512,1024,2048,4096,8192].map((e=>({key:e,value:e}))),fr=a.memo((({settings:e,setSettings:t,downloadSize:n})=>a.createElement("div",null,a.createElement(da,{name:"Image type",selected:e.type,values:[{key:"JPEG",value:"image/jpeg"},{key:"PNG",value:"image/png"},{key:"SVG",value:"image/svg+xml"}],onChange:n=>t(Object.assign(Object.assign({},e),{type:n}))}),"image/svg+xml"!==e.type&&a.createElement(xn.Z,{value:e.size,placeholder:"Size",options:hr,onChange:n=>t(Object.assign(Object.assign({},e),{size:n}))}),a.createElement(en,{value:e.quality,min:.1,max:1,step:.1,onChange:n=>t(Object.assign(Object.assign({},e),{quality:n}))}),"image/jpeg"!==e.type&&a.createElement(Dt.Z,{checked:e.noBackground,onChange:n=>t(Object.assign(Object.assign({},e),{noBackground:n})),name:"Remove background color"}),n&&a.createElement("div",null,n))));var gr=n(87163),vr=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const yr=o.ZP.div`
	svg {
		width: 100%;
		height: 100%;
	}
`,br=a.memo((0,r.$j)((e=>({project:e.project})))((({project:e,closeModal:t})=>{const[n,r]=a.useState(null),[o,s]=a.useState({size:1024,quality:.8,time:0,type:"image/jpeg",noBackground:!1}),[l,c]=a.useState(!1),[d,m]=a.useState(null),[u,h]=a.useState(null);return a.useEffect((()=>()=>{Ee.ask("render-stop")}),[]),a.createElement("div",null,a.createElement(Zt,{columns:2,style:{width:i.Z.add(7,5)}},a.createElement("div",{style:{width:i.Z.ms(7),position:"relative"}},l&&a.createElement("div",{style:{position:"absolute",zIndex:1,background:"rgba(255,255,255,.4)",width:"100%",height:"100%"}},a.createElement(gr.Z,null)),n?a.createElement(yr,null,a.createElement("div",{dangerouslySetInnerHTML:{__html:n}})):a.createElement(pr,{ratio:e.ratio,render:d,settings:o})),a.createElement("div",null,a.createElement(fr,{settings:o,setSettings:s,downloadSize:u}),a.createElement("button",{disabled:l,onClick:function(){return vr(this,void 0,void 0,(function*(){if(!l){c(!0);const e=yield Ee.ask("render-image",{settings:o});if("image/svg+xml"===o.type)r(e.svg),c(!1);else{const t=new Blob([e],{type:o.type}),n=new Image;n.addEventListener("load",(()=>{m(n),c(!1),h((0,p.fm)(t.size))}),{passive:!0}),n.src=window.URL.createObjectURL(t)}}}))}},"render"),(n||d)&&a.createElement("div",{onClick:()=>function(){if(n||d){const t="image/jpeg"===o.type?"jpg":"image/svg+xml"===o.type?"svg":"png";De(e.name+"."+t,n||d,o.type)}}()},"download"))),a.createElement("div",{style:{padding:`${i.Z.ms(0)} ${i.Z.ms(-1)} 0`}},a.createElement(Rn,{enableMoveTime:!0,sequence_duration:e.sequence.duration,sequence_framerate:e.sequence.framerate,renderedFrames:[],current_time:o.time,onChange:e=>s(Object.assign(Object.assign({},o),{time:e})),steps:8})),a.createElement("div",{onClick:t},"Close"))})));var Er=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const Zr={estimated_time:0,forPart:0,total_frames:0,total_parts:0,start_time:0,remaining_time:0,current_frame:0,progress_percentage:0},wr=[256,512,1080,1024,2048,4096,8192].map((e=>({key:e,value:e}))),xr=a.memo((0,r.$j)((e=>({project:e.project})))((({project:e,closeModal:t})=>{const[n,r]=a.useState(!1),[i,o]=a.useState(!1),[s,l]=a.useState(Zr),[c,d]=a.useState({index:0,samples:[]}),[m,u]=a.useState({size:1080,quality:1,time:0,type:"image/jpeg",noBackground:!1}),[h,f]=a.useState(null);function g(e){const t=c.samples.length;let n=e;if(t>0){let e=0;for(let n=0;n<t;n++)e+=c.samples[n];n=Math.round(e/t)}return c.samples[c.index]=Math.round(e),c.index=(c.index+1)%100,d(Object.assign({},c)),n}function v(t){h&&h.length>0&&h.length>=t&&De(`${e.name&&e.name.length>0?e.name:Oe.Z.empty_project_name}_part_${t+1}`,h[t],"application/zip")}function y(){return Er(this,void 0,void 0,(function*(){console.log("stop"),o(!0),yield Ee.ask("render-stop"),r(!1),o(!1)}))}return a.useEffect((()=>{function t(e){const t=e;l(Object.assign(Object.assign({},t),{start_time:(0,p.zO)(),remaining_time:t.estimated_time,current_frame:0,progress_percentage:0}))}function n(t){const n=t,a=Math.round(100*++n.frame/s.total_frames*100)/100;document.title=a+"% "+e.name,l(Object.assign(Object.assign({},s),{remaining_time:g(n.render_time)*s.total_frames-((0,p.zO)()-s.start_time),current_frame:n.frame+1,progress_percentage:a}))}return Ee.attach("renderer:start",t),Ee.attach("renderer:render-frame",n),()=>{Ee.detach("renderer:start",t),Ee.detach("renderer:render-frame",n)}}),[s,c,n]),a.createElement("div",null,i&&a.createElement("div",null,"wait stop..."),a.createElement(xn.Z,{value:m.size,placeholder:"Size",options:wr,onChange:e=>u(Object.assign(Object.assign({},m),{size:e}))}),a.createElement("button",{onClick:function(){return Er(this,void 0,void 0,(function*(){r(!0);const e=yield Ee.ask("render-animation",{settings:m});f(e),r(!1)}))},disabled:n},"render"),a.createElement("button",{onClick:y,disabled:!n},"stop"),a.createElement("div",null,"frame: ",s.current_frame," su ",s.total_frames,a.createElement("br",null),"part: ",s.total_parts,a.createElement("br",null),"rem: ",s.remaining_time<=0?0:Math.floor(s.remaining_time/1e3),"s",a.createElement("br",null),"prog: ",s.progress_percentage,"%",a.createElement("br",null)),h&&a.createElement("div",null,h.map(((e,t)=>a.createElement("div",{key:t,onClick:()=>v(t)},"zip_part_",t+1," - ",(0,p.fm)(e.size)))),a.createElement("div",{onClick:function(){if(h&&h.length>0)for(let e=0;e<h.length;e++)v(e)}},"download all")),a.createElement("div",{onClick:function(){return Er(this,void 0,void 0,(function*(){yield y(),document.title=Oe.Z.getDocumentProjectTitle(e.name),t()}))}},"Close"))})));var kr=function(e,t,n,a){return new(n||(n=Promise))((function(r,i){function o(e){try{l(a.next(e))}catch(e){i(e)}}function s(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((a=a.apply(e,t||[])).next())}))};const _r=a.memo((0,r.$j)((e=>({project:e.project})))((()=>{const[e,t]=a.useState(ee.Z.defaults),[n,r]=a.useState("");return console.log(e),a.createElement("div",null,Object.keys(e).map((n=>a.createElement("div",{key:n},n," ",a.createElement("input",{className:"input",type:"text",value:e[n],name:n,onChange:n=>{return a=n.target.name,r=n.target.value,["penUpCommand","penDownCommand"].includes(a)||(r=parseFloat(r)),void t(Object.assign(Object.assign({},e),{[a]:r}));var a,r}})))),a.createElement("button",{onClick:function(){return kr(this,void 0,void 0,(function*(){console.log("settings",e);const t=yield Ee.ask("export-gcode",{settings:e});console.log("OK"),r(t)}))}},"Generate"),a.createElement("textarea",{className:"input textarea",value:n,readOnly:!0,style:{width:"400px",height:"400px"}}))}))),Cr=a.memo((0,r.$j)((e=>({modal:e.app.opened_modal,modal_props:e.app.opened_modal_props})),(e=>({closeModal:()=>e((0,ye.h7)(void 0))})))((({modal:e,modal_props:t,closeModal:n})=>e?a.createElement(za,{open:!0,close:n,noCloseButton:"render-animation"==e||"render-image"==e},function(e){switch(e){case"render-image":return a.createElement(br,Object.assign({},t,{closeModal:n}));case"render-animation":return a.createElement(xr,Object.assign({},t,{closeModal:n}));case"generate-gcode":return a.createElement(_r,Object.assign({},t,{closeModal:n}))}}(e)):null))),Sr={rows:3,flow:`${i.Z.ms(2)} auto ${i.Z.ms(1)}`,style:{height:"100vh"},component:"section"},$r=a.memo((0,r.$j)((e=>({bTutorial:e.app.bTutorial,bSplashScreen:e.app.bSplashScreen})))((({bSplashScreen:e,bTutorial:t})=>a.createElement(a.Fragment,null,a.createElement(Zt,Object.assign({},Sr),a.createElement(tt,null),a.createElement(nr,null),a.createElement(mt,null),a.createElement(ft,null)),t&&a.createElement(ur,null),e&&a.createElement(cr,null),a.createElement(Cr,null)))))},791:()=>{}}]);